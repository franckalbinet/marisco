<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NetCDF2CSV – marisco</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-cd333c7267348b54b15a9ec2a617d176.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="NetCDF2CSV – marisco">
<meta property="og:description" content="MARIS companion package and tutorials">
<meta property="og:site_name" content="marisco">
<meta name="twitter:title" content="NetCDF2CSV – marisco">
<meta name="twitter:description" content="MARIS companion package and tutorials">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">marisco</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/franckalbinet/marisco"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../api/callbacks.html">API</a></li><li class="breadcrumb-item"><a href="../api/netcdf2csv.html">NetCDF2CSV</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MARISCO</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Handlers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/helcom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HELCOM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/ospar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OSPAR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/geotraces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geotraces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/maris_legacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MARIS Legacy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/tepco.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEPCO</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/callbacks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Callbacks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/configs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/encoders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Encoders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/decoders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decoders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/netcdf2csv.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">NetCDF2CSV</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../metadata/data-curation-rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data curation rules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../metadata/field-definition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Field definitions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link active" data-scroll-target="#dependencies">Dependencies</a>
  <ul>
  <li><a href="#configuration-and-file-paths" id="toc-configuration-and-file-paths" class="nav-link" data-scroll-target="#configuration-and-file-paths">Configuration and File Paths</a></li>
  <li><a href="#data-loading" id="toc-data-loading" class="nav-link" data-scroll-target="#data-loading">Data Loading</a></li>
  <li><a href="#validate-netcdf-enumerations" id="toc-validate-netcdf-enumerations" class="nav-link" data-scroll-target="#validate-netcdf-enumerations">Validate NetCDF Enumerations</a>
  <ul>
  <li><a href="#validateenumscb" id="toc-validateenumscb" class="nav-link" data-scroll-target="#validateenumscb">ValidateEnumsCB</a></li>
  </ul></li>
  <li><a href="#remove-non-compatible-columns" id="toc-remove-non-compatible-columns" class="nav-link" data-scroll-target="#remove-non-compatible-columns">Remove Non Compatible Columns</a>
  <ul>
  <li><a href="#removenoncompatiblevariablescb" id="toc-removenoncompatiblevariablescb" class="nav-link" data-scroll-target="#removenoncompatiblevariablescb">RemoveNonCompatibleVariablesCB</a></li>
  </ul></li>
  <li><a href="#sample-id-handling" id="toc-sample-id-handling" class="nav-link" data-scroll-target="#sample-id-handling">Sample ID Handling</a>
  <ul>
  <li><a href="#sampleidconversioncb" id="toc-sampleidconversioncb" class="nav-link" data-scroll-target="#sampleidconversioncb">SampleIDConversionCB</a></li>
  </ul></li>
  <li><a href="#add-taxon-information" id="toc-add-taxon-information" class="nav-link" data-scroll-target="#add-taxon-information">Add Taxon Information</a>
  <ul>
  <li><a href="#get_taxon_info_lut" id="toc-get_taxon_info_lut" class="nav-link" data-scroll-target="#get_taxon_info_lut">get_taxon_info_lut</a></li>
  <li><a href="#addtaxoninformationcb" id="toc-addtaxoninformationcb" class="nav-link" data-scroll-target="#addtaxoninformationcb">AddTaxonInformationCB</a></li>
  </ul></li>
  <li><a href="#standardize-time" id="toc-standardize-time" class="nav-link" data-scroll-target="#standardize-time">Standardize Time</a></li>
  <li><a href="#add-sample-type-id" id="toc-add-sample-type-id" class="nav-link" data-scroll-target="#add-sample-type-id">Add Sample Type ID</a></li>
  <li><a href="#add-reference-id" id="toc-add-reference-id" class="nav-link" data-scroll-target="#add-reference-id">Add Reference ID</a>
  <ul>
  <li><a href="#addzoteroarchivelocationcb" id="toc-addzoteroarchivelocationcb" class="nav-link" data-scroll-target="#addzoteroarchivelocationcb">AddZoteroArchiveLocationCB</a></li>
  </ul></li>
  <li><a href="#remap-to-open-refine-specific-mappings" id="toc-remap-to-open-refine-specific-mappings" class="nav-link" data-scroll-target="#remap-to-open-refine-specific-mappings">Remap to Open Refine specific mappings</a>
  <ul>
  <li><a href="#remaptoorspecificmappingscb" id="toc-remaptoorspecificmappingscb" class="nav-link" data-scroll-target="#remaptoorspecificmappingscb">RemapToORSpecificMappingsCB</a></li>
  </ul></li>
  <li><a href="#remap-to-csv-data-type-format" id="toc-remap-to-csv-data-type-format" class="nav-link" data-scroll-target="#remap-to-csv-data-type-format">Remap to CSV data type format</a>
  <ul>
  <li><a href="#get_excluded_enums" id="toc-get_excluded_enums" class="nav-link" data-scroll-target="#get_excluded_enums">get_excluded_enums</a></li>
  <li><a href="#dataformatconversioncb" id="toc-dataformatconversioncb" class="nav-link" data-scroll-target="#dataformatconversioncb">DataFormatConversionCB</a></li>
  </ul></li>
  <li><a href="#review-all-callbacks" id="toc-review-all-callbacks" class="nav-link" data-scroll-target="#review-all-callbacks">Review all callbacks</a></li>
  <li><a href="#decode" id="toc-decode" class="nav-link" data-scroll-target="#decode">Decode</a>
  <ul>
  <li><a href="#decode-1" id="toc-decode-1" class="nav-link" data-scroll-target="#decode-1">decode</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/franckalbinet/marisco/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../api/callbacks.html">API</a></li><li class="breadcrumb-item"><a href="../api/netcdf2csv.html">NetCDF2CSV</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">NetCDF2CSV</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<blockquote class="blockquote">
<p>A data pipeline that converts MARIS NetCDF files into MARIS Standard OpenRefine CSV format.</p>
</blockquote>
<p>This module converts NetCDF files into CSV files that follow the MARIS Standard <a href="https://openrefine.org/">OpenRefine</a> format. While MARISCO has replaced OpenRefine in the data cleaning and preparation pipeline, the MARIS master database still requires input files to conform to this CSV format specification. The conversion is performed using the marisco library.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For new MARIS users, please refer to <a href="https://github.com/franckalbinet/marisco/blob/main/nbs/metadata/field-definition.ipynb">field definitions</a> for detailed information about Maris fields.</p>
</div>
</div>
<section id="dependencies" class="level1">
<h1>Dependencies</h1>
<blockquote class="blockquote">
<p>Required packages and internal modules for data format transformations</p>
</blockquote>
<div id="cell-6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="configuration-and-file-paths" class="level2">
<h2 class="anchored" data-anchor-id="configuration-and-file-paths">Configuration and File Paths</h2>
<div id="cell-8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fname_in =  Path('../../_data/output/tepco.nc')</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fname_in <span class="op">=</span>  Path(<span class="st">'../../_data/output/100-HELCOM-MORS-2024.nc'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>fname_out <span class="op">=</span> fname_in.with_suffix(<span class="st">'.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_format <span class="op">=</span> <span class="st">'openrefine_csv'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-loading" class="level2">
<h2 class="anchored" data-anchor-id="data-loading">Data Loading</h2>
<p>Load data from standardized MARIS NetCDF files using ExtractNetcdfContents. The NetCDF files follow CF conventions and include standardized variable names and metadata according to MARIS specifications.</p>
<div id="cell-11" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Show the dictionary of dataframes extracted from the NetCDF file.</p>
<div id="cell-13" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>contents.dfs.keys()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>dict_keys(['BIOTA', 'SEAWATER', 'SEDIMENT'])</code></pre>
</div>
</div>
<p>Show an example of the DataFrame extracted from the NetCDF file.</p>
<div id="cell-15" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    display(contents.dfs[<span class="st">'SEAWATER'</span>].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SMP_ID_PROVIDER</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">TOT_DEPTH</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">SMP_ID</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">FILT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>WKRIL2012003</td>
<td>29.333300</td>
<td>60.083302</td>
<td>0.0</td>
<td>NaN</td>
<td>1337731200</td>
<td>1</td>
<td>33</td>
<td>5.300000</td>
<td>1</td>
<td>1.696</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>WKRIL2012004</td>
<td>29.333300</td>
<td>60.083302</td>
<td>29.0</td>
<td>NaN</td>
<td>1337731200</td>
<td>2</td>
<td>33</td>
<td>19.900000</td>
<td>1</td>
<td>3.980</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>WKRIL2012005</td>
<td>23.150000</td>
<td>59.433300</td>
<td>0.0</td>
<td>NaN</td>
<td>1339891200</td>
<td>3</td>
<td>33</td>
<td>25.500000</td>
<td>1</td>
<td>5.100</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>WKRIL2012006</td>
<td>27.983299</td>
<td>60.250000</td>
<td>0.0</td>
<td>NaN</td>
<td>1337817600</td>
<td>4</td>
<td>33</td>
<td>17.000000</td>
<td>1</td>
<td>4.930</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>WKRIL2012007</td>
<td>27.983299</td>
<td>60.250000</td>
<td>39.0</td>
<td>NaN</td>
<td>1337817600</td>
<td>5</td>
<td>33</td>
<td>22.200001</td>
<td>1</td>
<td>3.996</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Show an example of the dictionary of enums extracted from the NetCDF file as a DataFrame.</p>
<div id="cell-17" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>grp<span class="op">=</span><span class="st">'SEAWATER'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Variables in </span><span class="sc">{</span>grp<span class="sc">}</span><span class="ss"> group: </span><span class="sc">{</span>contents<span class="sc">.</span>enum_dicts[grp]<span class="sc">.</span>keys()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>var<span class="op">=</span><span class="st">'dl'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    display(pd.DataFrame.from_dict(contents.enum_dicts[grp][var], orient<span class="op">=</span><span class="st">'index'</span>).T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables in SEAWATER group: dict_keys(['nuclide', 'unit', 'dl', 'filt'])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Not applicable</th>
<th data-quarto-table-cell-role="th">Not available</th>
<th data-quarto-table-cell-role="th">Detected value</th>
<th data-quarto-table-cell-role="th">Detection limit</th>
<th data-quarto-table-cell-role="th">Not detected</th>
<th data-quarto-table-cell-role="th">Derived</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>-1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Show the global attributes extracted from the NetCDF file.</p>
<div id="cell-19" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"First few attributes from global attributes:"</span>, <span class="bu">list</span>(contents.global_attrs.items())[:<span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>First few attributes from global attributes: [('id', '26VMZZ2Q'), ('title', 'Environmental database - Helsinki Commission Monitoring of Radioactive Substances'), ('summary', 'MORS Environment database has been used to collate data resulting from monitoring of environmental radioactivity in the Baltic Sea based on HELCOM Recommendation 26/3.\n\nThe database is structured according to HELCOM Guidelines on Monitoring of Radioactive Substances (https://www.helcom.fi/wp-content/uploads/2019/08/Guidelines-for-Monitoring-of-Radioactive-Substances.pdf), which specifies reporting format, database structure, data types and obligatory parameters used for reporting data under Recommendation 26/3.\n\nThe database is updated and quality assured annually by HELCOM MORS EG.'), ('keywords', 'oceanography, Earth Science &gt; Oceans &gt; Ocean Chemistry&gt; Radionuclides, Earth Science &gt; Human Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation Exposure, Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean Tracers, Earth Science &gt; Oceans &gt; Marine Sediments, Earth Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt; Sea Ice &gt; Isotopes, Earth Science &gt; Oceans &gt; Water Quality &gt; Ocean Contaminants, Earth Science &gt; Biological Classification &gt; Animals/Vertebrates &gt; Fish, Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans, Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)'), ('history', 'TBD')]</code></pre>
</div>
</div>
<p>Show the custom maps extracted from the NetCDF file.</p>
<div id="cell-21" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>grp<span class="op">=</span><span class="st">'SEAWATER'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Custom maps in </span><span class="sc">{</span>grp<span class="sc">}</span><span class="ss"> group: </span><span class="sc">{</span>contents<span class="sc">.</span>custom_maps[grp]<span class="sc">.</span>keys()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    display(pd.DataFrame.from_dict(contents.custom_maps[grp], orient<span class="op">=</span><span class="st">'index'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Custom maps in SEAWATER group: dict_keys([])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="validate-netcdf-enumerations" class="level2">
<h2 class="anchored" data-anchor-id="validate-netcdf-enumerations">Validate NetCDF Enumerations</h2>
<p>Verify that enumerated values in the NetCDF file match current MARIS lookup tables.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>FEEDBACK TO DATA PROVIDERS
</div>
</div>
<div class="callout-body-container callout-body">
<p>The enumeration validation process is a diagnostic step that identifies inconsistencies between NetCDF enumerations and MARIS lookup tables. While this validation does not modify the dataset, it generates detailed feedback about any mismatches or undefined values.</p>
</div>
</div>
<div id="cell-25" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>NC_VARS</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'SMP_ID': 'smp_id',
 'SMP_ID_PROVIDER': 'id_provider',
 'LON': 'lon',
 'LAT': 'lat',
 'SMP_DEPTH': 'smp_depth',
 'TOT_DEPTH': 'tot_depth',
 'TIME': 'time',
 'AREA': 'area',
 'NUCLIDE': 'nuclide',
 'VALUE': 'value',
 'UNIT': 'unit',
 'UNC': 'unc',
 'DL': 'dl',
 'DLV': 'dlv',
 'FILT': 'filt',
 'COUNT_MET': 'count_met',
 'SAMP_MET': 'samp_met',
 'PREP_MET': 'prep_met',
 'VOL': 'vol',
 'SAL': 'sal',
 'TEMP': 'temp',
 'PH': 'ph',
 'BIO_GROUP': 'bio_group',
 'SPECIES': 'species',
 'BODY_PART': 'body_part',
 'SED_TYPE': 'sed_type',
 'TOP': 'top',
 'BOTTOM': 'bottom',
 'DRYWT': 'drywt',
 'WETWT': 'wetwt',
 'PERCENTWT': 'percentwt',
 'LAB': 'lab',
 'PROFILE_ID': 'profile_id',
 'STATION': 'station'}</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L46" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="validateenumscb" class="level3">
<h3 class="anchored" data-anchor-id="validateenumscb">ValidateEnumsCB</h3>
<blockquote class="blockquote">
<pre><code> ValidateEnumsCB (contents, maris_enums, verbose=False)</code></pre>
</blockquote>
<p><em>Validate enumeration mappings between NetCDF file and MARIS lookup tables.</em></p>
<div id="cell-27" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span> contents.dfs,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        ValidateEnumsCB(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            contents <span class="op">=</span> contents,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            maris_enums<span class="op">=</span>Enums(lut_src_dir<span class="op">=</span>lut_path())</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>tfm()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'BIOTA':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH        TIME  SMP_ID  \
 0        BVTIG2012041  12.316667  54.283333        NaN  1348358400       1   
 1        BVTIG2012041  12.316667  54.283333        NaN  1348358400       2   
 2        BVTIG2012041  12.316667  54.283333        NaN  1348358400       3   
 3        BVTIG2012041  12.316667  54.283333        NaN  1348358400       4   
 4        BVTIG2012040  12.316667  54.283333        NaN  1348358400       5   
 ...               ...        ...        ...        ...         ...     ...   
 16089    BSTUK2022010  21.395000  61.241501        2.0  1652140800   16090   
 16090    BSTUK2022010  21.395000  61.241501        2.0  1652140800   16091   
 16091    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16092   
 16092    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16093   
 16093    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16094   
 
        NUCLIDE       VALUE  UNIT       UNC  DL  BIO_GROUP  SPECIES  BODY_PART  \
 0           31    0.010140     5       NaN   2          4       99         52   
 1            4  135.300003     5  4.830210   1          4       99         52   
 2            9    0.013980     5       NaN   2          4       99         52   
 3           33    4.338000     5  0.150962   1          4       99         52   
 4           31    0.009614     5       NaN   2          4       99         52   
 ...        ...         ...   ...       ...  ..        ...      ...        ...   
 16089       33   13.700000     4  0.520600   1         11       96         55   
 16090        9    0.500000     4  0.045500   1         11       96         55   
 16091        4   50.700001     4  4.106700   1         14      129          1   
 16092       33    0.880000     4  0.140800   1         14      129          1   
 16093       12    6.600000     4  0.349800   1         14      129          1   
 
             DRYWT  WETWT  PERCENTWT  
 0      174.934433  948.0    0.18453  
 1      174.934433  948.0    0.18453  
 2      174.934433  948.0    0.18453  
 3      174.934433  948.0    0.18453  
 4      177.935120  964.0    0.18458  
 ...           ...    ...        ...  
 16089         NaN    NaN        NaN  
 16090         NaN    NaN        NaN  
 16091         NaN    NaN        NaN  
 16092         NaN    NaN        NaN  
 16093         NaN    NaN        NaN  
 
 [16094 rows x 17 columns],
 'SEAWATER':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH  TOT_DEPTH        TIME  \
 0        WKRIL2012003  29.333300  60.083302        0.0        NaN  1337731200   
 1        WKRIL2012004  29.333300  60.083302       29.0        NaN  1337731200   
 2        WKRIL2012005  23.150000  59.433300        0.0        NaN  1339891200   
 3        WKRIL2012006  27.983299  60.250000        0.0        NaN  1337817600   
 4        WKRIL2012007  27.983299  60.250000       39.0        NaN  1337817600   
 ...               ...        ...        ...        ...        ...         ...   
 21468    WDHIG2023112  13.499833  54.600334        0.0       47.0  1686441600   
 21469    WDHIG2023113  13.499833  54.600334       45.0       47.0  1686441600   
 21470    WDHIG2023143  14.200833  54.600334        0.0       11.0  1686614400   
 21471    WDHIG2023145  14.665500  54.600334        0.0       20.0  1686614400   
 21472    WDHIG2023147  14.330000  54.600334        0.0       17.0  1686614400   
 
        SMP_ID  NUCLIDE       VALUE  UNIT        UNC  DL  FILT  
 0           1       33    5.300000     1   1.696000   1     0  
 1           2       33   19.900000     1   3.980000   1     0  
 2           3       33   25.500000     1   5.100000   1     0  
 3           4       33   17.000000     1   4.930000   1     0  
 4           5       33   22.200001     1   3.996000   1     0  
 ...       ...      ...         ...   ...        ...  ..   ...  
 21468   21469        1  702.838074     1  51.276207   1     0  
 21469   21470        1  725.855713     1  52.686260   1     0  
 21470   21471        1  648.992920     1  48.154419   1     0  
 21471   21472        1  627.178406     1  46.245316   1     0  
 21472   21473        1  605.715088     1  45.691143   1     0  
 
 [21473 rows x 13 columns],
 'SEDIMENT':       SMP_ID_PROVIDER        LON        LAT  TOT_DEPTH        TIME  SMP_ID  \
 0        SKRIL2012116  27.799999  60.466667       25.0  1337904000       1   
 1        SKRIL2012117  27.799999  60.466667       25.0  1337904000       2   
 2        SKRIL2012118  27.799999  60.466667       25.0  1337904000       3   
 3        SKRIL2012119  27.799999  60.466667       25.0  1337904000       4   
 4        SKRIL2012120  27.799999  60.466667       25.0  1337904000       5   
 ...               ...        ...        ...        ...         ...     ...   
 70444    SCLOR2022071  15.537800  54.617832       62.0  1654646400   70445   
 70445    SCLOR2022071  15.537800  54.617832       62.0  1654646400   70446   
 70446    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70447   
 70447    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70448   
 70448    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70449   
 
        NUCLIDE        VALUE  UNIT         UNC  DL  SED_TYPE   TOP  BOTTOM  \
 0           33  1200.000000     3  240.000000   1         0  15.0    20.0   
 1           33   250.000000     3   50.000000   1         0  20.0    25.0   
 2           33   140.000000     3   29.400000   1         0  25.0    30.0   
 3           33    79.000000     3   15.800000   1         0  30.0    35.0   
 4           33    29.000000     3    6.960000   1         0  35.0    40.0   
 ...        ...          ...   ...         ...  ..       ...   ...     ...   
 70444       67     0.044000     2    0.015312   1        10  15.0    17.0   
 70445       77     2.500000     2    0.185000   1        10  15.0    17.0   
 70446        4  5873.000000     2  164.444000   1        10  17.0    19.0   
 70447       33    21.200001     2    2.162400   1        10  17.0    19.0   
 70448       77     0.370000     2    0.048100   1        10  17.0    19.0   
 
        PERCENTWT  
 0            NaN  
 1            NaN  
 2            NaN  
 3            NaN  
 4            NaN  
 ...          ...  
 70444   0.257642  
 70445   0.257642  
 70446   0.263965  
 70447   0.263965  
 70448   0.263965  
 
 [70449 rows x 15 columns]}</code></pre>
</div>
</div>
</section>
</section>
<section id="remove-non-compatible-columns" class="level2">
<h2 class="anchored" data-anchor-id="remove-non-compatible-columns">Remove Non Compatible Columns</h2>
<p>The <code>[</code>RemoveNonCompatibleVariablesCB<code>](https://franckalbinet.github.io/marisco/api/netcdf2csv.html#removenoncompatiblevariablescb)</code> callback filters out variables from the NetCDF format that are not listed in the VARS configuration.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L85" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="removenoncompatiblevariablescb" class="level3">
<h3 class="anchored" data-anchor-id="removenoncompatiblevariablescb">RemoveNonCompatibleVariablesCB</h3>
<blockquote class="blockquote">
<pre><code> RemoveNonCompatibleVariablesCB (vars:Dict[str,str]={'LON': 'longitude',
                                 'LAT': 'latitude', 'SMP_DEPTH':
                                 'sampdepth', 'TOT_DEPTH': 'totdepth',
                                 'TIME': 'begperiod', 'AREA': 'area',
                                 'NUCLIDE': 'nuclide_id', 'VALUE':
                                 'activity', 'UNIT': 'unit_id', 'UNC':
                                 'uncertaint', 'DL': 'detection', 'DLV':
                                 'detection_lim', 'FILT': 'filtered',
                                 'COUNT_MET': 'counmet_id', 'SAMP_MET':
                                 'sampmet_id', 'PREP_MET': 'prepmet_id',
                                 'VOL': 'volume', 'SAL': 'salinity',
                                 'TEMP': 'temperatur', 'SPECIES':
                                 'species_id', 'BODY_PART': 'bodypar_id',
                                 'SED_TYPE': 'sedtype_id', 'TOP':
                                 'sliceup', 'BOTTOM': 'slicedown',
                                 'DRYWT': 'drywt', 'WETWT': 'wetwt',
                                 'PERCENTWT': 'percentwt', 'LAB':
                                 'lab_id', 'PROFILE_ID': 'profile_id',
                                 'SAMPLE_TYPE': 'samptype_id',
                                 'TAXONNAME': 'taxonname', 'TAXONREPNAME':
                                 'taxonrepname', 'TAXONRANK': 'taxonrank',
                                 'TAXONDB': 'taxondb', 'TAXONDBID':
                                 'taxondb_id', 'TAXONDBURL':
                                 'taxondb_url', 'REF_ID': 'ref_id',
                                 'SMP_ID_PROVIDER': 'samplabcode',
                                 'STATION': 'station'},
                                 verbose:bool=False)</code></pre>
</blockquote>
<p><em>Remove variables not listed in VARS configuration.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>vars</td>
<td>Dict</td>
<td>{‘LON’: ‘longitude’, ‘LAT’: ‘latitude’, ‘SMP_DEPTH’: ‘sampdepth’, ‘TOT_DEPTH’: ‘totdepth’, ‘TIME’: ‘begperiod’, ‘AREA’: ‘area’, ‘NUCLIDE’: ‘nuclide_id’, ‘VALUE’: ‘activity’, ‘UNIT’: ‘unit_id’, ‘UNC’: ‘uncertaint’, ‘DL’: ‘detection’, ‘DLV’: ‘detection_lim’, ‘FILT’: ‘filtered’, ‘COUNT_MET’: ‘counmet_id’, ‘SAMP_MET’: ‘sampmet_id’, ‘PREP_MET’: ‘prepmet_id’, ‘VOL’: ‘volume’, ‘SAL’: ‘salinity’, ‘TEMP’: ‘temperatur’, ‘SPECIES’: ‘species_id’, ‘BODY_PART’: ‘bodypar_id’, ‘SED_TYPE’: ‘sedtype_id’, ‘TOP’: ‘sliceup’, ‘BOTTOM’: ‘slicedown’, ‘DRYWT’: ‘drywt’, ‘WETWT’: ‘wetwt’, ‘PERCENTWT’: ‘percentwt’, ‘LAB’: ‘lab_id’, ‘PROFILE_ID’: ‘profile_id’, ‘SAMPLE_TYPE’: ‘samptype_id’, ‘TAXONNAME’: ‘taxonname’, ‘TAXONREPNAME’: ‘taxonrepname’, ‘TAXONRANK’: ‘taxonrank’, ‘TAXONDB’: ‘taxondb’, ‘TAXONDBID’: ‘taxondb_id’, ‘TAXONDBURL’: ‘taxondb_url’, ‘REF_ID’: ‘ref_id’, ‘SMP_ID_PROVIDER’: ‘samplabcode’, ‘STATION’: ‘station’}</td>
<td>Dictionary mapping OR vars to NC vars</td>
</tr>
<tr class="even">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-31" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        RemoveNonCompatibleVariablesCB(<span class="bu">vars</span><span class="op">=</span>CSV_VARS, verbose<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm.dfs[<span class="st">'BIOTA'</span>].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing variables that are not compatible with vars provided. 
Removing SMP_ID, BIO_GROUP from BIOTA dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEAWATER dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEDIMENT dataset.
  SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH        TIME  NUCLIDE  \
0    BVTIG2012041  12.316667  54.283333        NaN  1348358400       31   
1    BVTIG2012041  12.316667  54.283333        NaN  1348358400        4   
2    BVTIG2012041  12.316667  54.283333        NaN  1348358400        9   
3    BVTIG2012041  12.316667  54.283333        NaN  1348358400       33   
4    BVTIG2012040  12.316667  54.283333        NaN  1348358400       31   

        VALUE  UNIT       UNC  DL  SPECIES  BODY_PART       DRYWT  WETWT  \
0    0.010140     5       NaN   2       99         52  174.934433  948.0   
1  135.300003     5  4.830210   1       99         52  174.934433  948.0   
2    0.013980     5       NaN   2       99         52  174.934433  948.0   
3    4.338000     5  0.150962   1       99         52  174.934433  948.0   
4    0.009614     5       NaN   2       99         52  177.935120  964.0   

   PERCENTWT  
0    0.18453  
1    0.18453  
2    0.18453  
3    0.18453  
4    0.18458  </code></pre>
</div>
</div>
</section>
</section>
<section id="sample-id-handling" class="level2">
<h2 class="anchored" data-anchor-id="sample-id-handling">Sample ID Handling</h2>
<p>The MARISCO NetCDF encoding pipeline uses <code>SMP_ID</code> to store unique identifiers for each sample measurement. These IDs can come from two sources:</p>
<ol type="1">
<li>Directly from data providers who supply their own unique identifiers</li>
<li>Auto-generated by MARISCO as incremented integers when providers don’t supply IDs</li>
</ol>
<p>The Maris database ingestion pipeline expects:</p>
<ul>
<li>The original <code>SMP_ID</code> if provided by the data source</li>
<li><code>None</code> if the ID was auto-generated by MARISCO</li>
</ul>
<p><em>Note: When writing to CSV, <code>SMP_ID</code> is renamed to <code>samplabcode</code> as defined in the <code>CSV_VARS</code> mapping in <code>configs.ipynb</code>.</em></p>
<p>The callback below implements this logic by providing an option to convert auto-generated <code>SMP_ID</code> values to <code>None</code> while preserving original provider-supplied IDs.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L110" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="sampleidconversioncb" class="level3">
<h3 class="anchored" data-anchor-id="sampleidconversioncb">SampleIDConversionCB</h3>
<blockquote class="blockquote">
<pre><code> SampleIDConversionCB (nonify:bool=False)</code></pre>
</blockquote>
<p><em>Convert auto-generated <code>SMP_ID</code> values to <code>None</code> while preserving original provider-supplied IDs.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>nonify</td>
<td>bool</td>
<td>False</td>
<td>If True, convert auto-generated <code>SMP_ID</code> values to <code>None</code></td>
</tr>
</tbody>
</table>
<div id="cell-34" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        RemoveNonCompatibleVariablesCB(<span class="bu">vars</span><span class="op">=</span>CSV_VARS, verbose<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># SampleIDConversionCB(nonify=True)</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm.dfs[<span class="st">'BIOTA'</span>].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing variables that are not compatible with vars provided. 
Removing SMP_ID, BIO_GROUP from BIOTA dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEAWATER dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEDIMENT dataset.
  SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH        TIME  NUCLIDE  \
0    BVTIG2012041  12.316667  54.283333        NaN  1348358400       31   
1    BVTIG2012041  12.316667  54.283333        NaN  1348358400        4   
2    BVTIG2012041  12.316667  54.283333        NaN  1348358400        9   
3    BVTIG2012041  12.316667  54.283333        NaN  1348358400       33   
4    BVTIG2012040  12.316667  54.283333        NaN  1348358400       31   

        VALUE  UNIT       UNC  DL  SPECIES  BODY_PART       DRYWT  WETWT  \
0    0.010140     5       NaN   2       99         52  174.934433  948.0   
1  135.300003     5  4.830210   1       99         52  174.934433  948.0   
2    0.013980     5       NaN   2       99         52  174.934433  948.0   
3    4.338000     5  0.150962   1       99         52  174.934433  948.0   
4    0.009614     5       NaN   2       99         52  177.935120  964.0   

   PERCENTWT  
0    0.18453  
1    0.18453  
2    0.18453  
3    0.18453  
4    0.18458  </code></pre>
</div>
</div>
</section>
</section>
<section id="add-taxon-information" class="level2">
<h2 class="anchored" data-anchor-id="add-taxon-information">Add Taxon Information</h2>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L132" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_taxon_info_lut" class="level3">
<h3 class="anchored" data-anchor-id="get_taxon_info_lut">get_taxon_info_lut</h3>
<blockquote class="blockquote">
<pre><code> get_taxon_info_lut (maris_lut:str, key_names:dict={'Taxonname':
                     'TAXONNAME', 'Taxonrank': 'TAXONRANK', 'TaxonDB':
                     'TAXONDB', 'TaxonDBID': 'TAXONDBID', 'TaxonDBURL':
                     'TAXONDBURL'})</code></pre>
</blockquote>
<p><em>Create lookup dictionary for taxon information from MARIS species lookup table.</em></p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L143" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="addtaxoninformationcb" class="level3">
<h3 class="anchored" data-anchor-id="addtaxoninformationcb">AddTaxonInformationCB</h3>
<blockquote class="blockquote">
<pre><code> AddTaxonInformationCB (fn_lut:Callable=&lt;function &lt;lambda&gt;&gt;,
                        verbose:bool=False)</code></pre>
</blockquote>
<p><em>Add taxon information to BIOTA group based on species lookup table.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fn_lut</td>
<td>Callable</td>
<td><lambda></lambda></td>
<td>Function that returns taxon lookup dictionary</td>
</tr>
<tr class="even">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-38" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        AddTaxonInformationCB(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            fn_lut<span class="op">=</span>lut_taxon</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>tfm()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'BIOTA':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH        TIME  SMP_ID  \
 0        BVTIG2012041  12.316667  54.283333        NaN  1348358400       1   
 1        BVTIG2012041  12.316667  54.283333        NaN  1348358400       2   
 2        BVTIG2012041  12.316667  54.283333        NaN  1348358400       3   
 3        BVTIG2012041  12.316667  54.283333        NaN  1348358400       4   
 4        BVTIG2012040  12.316667  54.283333        NaN  1348358400       5   
 ...               ...        ...        ...        ...         ...     ...   
 16089    BSTUK2022010  21.395000  61.241501        2.0  1652140800   16090   
 16090    BSTUK2022010  21.395000  61.241501        2.0  1652140800   16091   
 16091    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16092   
 16092    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16093   
 16093    BSTUK2022011  21.385000  61.343334        NaN  1663200000   16094   
 
        NUCLIDE       VALUE  UNIT       UNC  ...  SPECIES  BODY_PART  \
 0           31    0.010140     5       NaN  ...       99         52   
 1            4  135.300003     5  4.830210  ...       99         52   
 2            9    0.013980     5       NaN  ...       99         52   
 3           33    4.338000     5  0.150962  ...       99         52   
 4           31    0.009614     5       NaN  ...       99         52   
 ...        ...         ...   ...       ...  ...      ...        ...   
 16089       33   13.700000     4  0.520600  ...       96         55   
 16090        9    0.500000     4  0.045500  ...       96         55   
 16091        4   50.700001     4  4.106700  ...      129          1   
 16092       33    0.880000     4  0.140800  ...      129          1   
 16093       12    6.600000     4  0.349800  ...      129          1   
 
             DRYWT  WETWT  PERCENTWT          TAXONNAME  TAXONRANK   TAXONDB  \
 0      174.934433  948.0    0.18453       Gadus morhua    species  Wikidata   
 1      174.934433  948.0    0.18453       Gadus morhua    species  Wikidata   
 2      174.934433  948.0    0.18453       Gadus morhua    species  Wikidata   
 3      174.934433  948.0    0.18453       Gadus morhua    species  Wikidata   
 4      177.935120  964.0    0.18458       Gadus morhua    species  Wikidata   
 ...           ...    ...        ...                ...        ...       ...   
 16089         NaN    NaN        NaN  Fucus vesiculosus    species  Wikidata   
 16090         NaN    NaN        NaN  Fucus vesiculosus    species  Wikidata   
 16091         NaN    NaN        NaN     Mytilus edulis    species  Wikidata   
 16092         NaN    NaN        NaN     Mytilus edulis    species  Wikidata   
 16093         NaN    NaN        NaN     Mytilus edulis    species  Wikidata   
 
       TAXONDBID                             TAXONDBURL  
 0       Q199788  https://www.wikidata.org/wiki/Q199788  
 1       Q199788  https://www.wikidata.org/wiki/Q199788  
 2       Q199788  https://www.wikidata.org/wiki/Q199788  
 3       Q199788  https://www.wikidata.org/wiki/Q199788  
 4       Q199788  https://www.wikidata.org/wiki/Q199788  
 ...         ...                                    ...  
 16089   Q754755  https://www.wikidata.org/wiki/Q754755  
 16090   Q754755  https://www.wikidata.org/wiki/Q754755  
 16091    Q27855   https://www.wikidata.org/wiki/Q27855  
 16092    Q27855   https://www.wikidata.org/wiki/Q27855  
 16093    Q27855   https://www.wikidata.org/wiki/Q27855  
 
 [16094 rows x 22 columns],
 'SEAWATER':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH  TOT_DEPTH        TIME  \
 0        WKRIL2012003  29.333300  60.083302        0.0        NaN  1337731200   
 1        WKRIL2012004  29.333300  60.083302       29.0        NaN  1337731200   
 2        WKRIL2012005  23.150000  59.433300        0.0        NaN  1339891200   
 3        WKRIL2012006  27.983299  60.250000        0.0        NaN  1337817600   
 4        WKRIL2012007  27.983299  60.250000       39.0        NaN  1337817600   
 ...               ...        ...        ...        ...        ...         ...   
 21468    WDHIG2023112  13.499833  54.600334        0.0       47.0  1686441600   
 21469    WDHIG2023113  13.499833  54.600334       45.0       47.0  1686441600   
 21470    WDHIG2023143  14.200833  54.600334        0.0       11.0  1686614400   
 21471    WDHIG2023145  14.665500  54.600334        0.0       20.0  1686614400   
 21472    WDHIG2023147  14.330000  54.600334        0.0       17.0  1686614400   
 
        SMP_ID  NUCLIDE       VALUE  UNIT        UNC  DL  FILT  
 0           1       33    5.300000     1   1.696000   1     0  
 1           2       33   19.900000     1   3.980000   1     0  
 2           3       33   25.500000     1   5.100000   1     0  
 3           4       33   17.000000     1   4.930000   1     0  
 4           5       33   22.200001     1   3.996000   1     0  
 ...       ...      ...         ...   ...        ...  ..   ...  
 21468   21469        1  702.838074     1  51.276207   1     0  
 21469   21470        1  725.855713     1  52.686260   1     0  
 21470   21471        1  648.992920     1  48.154419   1     0  
 21471   21472        1  627.178406     1  46.245316   1     0  
 21472   21473        1  605.715088     1  45.691143   1     0  
 
 [21473 rows x 13 columns],
 'SEDIMENT':       SMP_ID_PROVIDER        LON        LAT  TOT_DEPTH        TIME  SMP_ID  \
 0        SKRIL2012116  27.799999  60.466667       25.0  1337904000       1   
 1        SKRIL2012117  27.799999  60.466667       25.0  1337904000       2   
 2        SKRIL2012118  27.799999  60.466667       25.0  1337904000       3   
 3        SKRIL2012119  27.799999  60.466667       25.0  1337904000       4   
 4        SKRIL2012120  27.799999  60.466667       25.0  1337904000       5   
 ...               ...        ...        ...        ...         ...     ...   
 70444    SCLOR2022071  15.537800  54.617832       62.0  1654646400   70445   
 70445    SCLOR2022071  15.537800  54.617832       62.0  1654646400   70446   
 70446    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70447   
 70447    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70448   
 70448    SCLOR2022072  15.537800  54.617832       62.0  1654646400   70449   
 
        NUCLIDE        VALUE  UNIT         UNC  DL  SED_TYPE   TOP  BOTTOM  \
 0           33  1200.000000     3  240.000000   1         0  15.0    20.0   
 1           33   250.000000     3   50.000000   1         0  20.0    25.0   
 2           33   140.000000     3   29.400000   1         0  25.0    30.0   
 3           33    79.000000     3   15.800000   1         0  30.0    35.0   
 4           33    29.000000     3    6.960000   1         0  35.0    40.0   
 ...        ...          ...   ...         ...  ..       ...   ...     ...   
 70444       67     0.044000     2    0.015312   1        10  15.0    17.0   
 70445       77     2.500000     2    0.185000   1        10  15.0    17.0   
 70446        4  5873.000000     2  164.444000   1        10  17.0    19.0   
 70447       33    21.200001     2    2.162400   1        10  17.0    19.0   
 70448       77     0.370000     2    0.048100   1        10  17.0    19.0   
 
        PERCENTWT  
 0            NaN  
 1            NaN  
 2            NaN  
 3            NaN  
 4            NaN  
 ...          ...  
 70444   0.257642  
 70445   0.257642  
 70446   0.263965  
 70447   0.263965  
 70448   0.263965  
 
 [70449 rows x 15 columns]}</code></pre>
</div>
</div>
</section>
</section>
<section id="standardize-time" class="level2">
<h2 class="anchored" data-anchor-id="standardize-time">Standardize Time</h2>
<div id="cell-40" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        DecodeTimeCB(),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm.dfs[<span class="st">'SEAWATER'</span>][<span class="st">'TIME'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0       2012-05-23
1       2012-05-23
2       2012-06-17
3       2012-05-24
4       2012-05-24
           ...    
21468   2023-06-11
21469   2023-06-11
21470   2023-06-13
21471   2023-06-13
21472   2023-06-13
Name: TIME, Length: 21473, dtype: datetime64[ns]</code></pre>
</div>
</div>
</section>
<section id="add-sample-type-id" class="level2">
<h2 class="anchored" data-anchor-id="add-sample-type-id">Add Sample Type ID</h2>
<div id="cell-42" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        AddSampleTypeIdColumnCB(),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm.dfs[<span class="st">'SEAWATER'</span>][<span class="st">'SAMPLE_TYPE'</span>].unique())</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(tfm.dfs['BIOTA']['SAMPLE_TYPE'].unique())</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print(tfm.dfs['SEDIMENT']['SAMPLE_TYPE'].unique())</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]</code></pre>
</div>
</div>
</section>
<section id="add-reference-id" class="level2">
<h2 class="anchored" data-anchor-id="add-reference-id">Add Reference ID</h2>
<p>Include the <code>ref_id</code> (i.e., Zotero Archive Location). The <code>ZoteroArchiveLocationCB</code> performs a lookup of the Zotero Archive Location based on the <code>Zotero key</code> defined in the global attributes of the MARIS NetCDF file as <code>id</code>.</p>
<div id="cell-45" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>contents.global_attrs[<span class="st">'id'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'26VMZZ2Q'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L196" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="addzoteroarchivelocationcb" class="level3">
<h3 class="anchored" data-anchor-id="addzoteroarchivelocationcb">AddZoteroArchiveLocationCB</h3>
<blockquote class="blockquote">
<pre><code> AddZoteroArchiveLocationCB (attrs:str, cfg:dict)</code></pre>
</blockquote>
<p><em>Fetch and append ‘Loc. in Archive’ from Zotero to DataFrame.</em></p>
<div id="cell-47" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        AddZoteroArchiveLocationCB(contents.global_attrs, cfg<span class="op">=</span>cfg()),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm.dfs[<span class="st">'SEAWATER'</span>][<span class="st">'REF_ID'</span>].unique())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[100]</code></pre>
</div>
</div>
</section>
</section>
<section id="remap-to-open-refine-specific-mappings" class="level2">
<h2 class="anchored" data-anchor-id="remap-to-open-refine-specific-mappings">Remap to Open Refine specific mappings</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>FEEDBACK FOR NEXT VERSION
</div>
</div>
<div class="callout-body-container callout-body">
<p>[To be further clarified]</p>
<p>The current approach of remapping to OR-specific mappings should be reconsidered. Considering that we already utilize MARISCO lookup tables in NetCDF for creating enums, it would be beneficial to extend their use to OpenRefine data formats as well. By doing so, we could eliminate the need for OpenRefine-specific mappings, streamlining the data transformation process. Lets review the lookup tables used to create the enums for NetCDF:</p>
</div>
</div>
<div id="cell-50" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>enums <span class="op">=</span> Enums(lut_src_dir<span class="op">=</span>lut_path())</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'DL enums: </span><span class="sc">{</span>enums<span class="sc">.</span>types[<span class="st">"DL"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'FILT enums: </span><span class="sc">{</span>enums<span class="sc">.</span>types[<span class="st">"FILT"</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>DL enums: {'Not applicable': -1, 'Not available': 0, 'Detected value': 1, 'Detection limit': 2, 'Not detected': 3, 'Derived': 4}
FILT enums: {'Not applicable': -1, 'Not available': 0, 'Yes': 1, 'No': 2}</code></pre>
</div>
</div>
<p>For the detection limit lookup table (LUT), as shown below, the values required for the OpenRefine CSV format are listed under the ‘name’ column, whereas the enums utilize the ‘name_sanitized’ column.</p>
<p>Additionally, for the filtered LUT, also shown below, the values do not align consistently with the OpenRefine CSV format, which uses (<code>Y</code>, <code>N</code>, <code>NA</code>).</p>
<div id="cell-52" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dl_lut <span class="op">=</span> pd.read_excel(detection_limit_lut_path())</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dl_lut</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">name_sanitized</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>-1</td>
<td>Not applicable</td>
<td>Not applicable</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>Not Available</td>
<td>Not available</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1</td>
<td>=</td>
<td>Detected value</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2</td>
<td>&lt;</td>
<td>Detection limit</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>3</td>
<td>ND</td>
<td>Not detected</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>4</td>
<td>DE</td>
<td>Derived</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-53" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>filtered_lut <span class="op">=</span> pd.read_excel(filtered_lut_path())</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>filtered_lut</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>-1</td>
<td>Not applicable</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>Not available</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1</td>
<td>Yes</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2</td>
<td>No</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We will create OpenRefine specific mappings for the detection limit and filtered data:</p>
<p>RemapToORSpecificMappingsCB remaps the values of the detection limit and filtered data to the OpenRefine CSV format.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L220" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="remaptoorspecificmappingscb" class="level3">
<h3 class="anchored" data-anchor-id="remaptoorspecificmappingscb">RemapToORSpecificMappingsCB</h3>
<blockquote class="blockquote">
<pre><code> RemapToORSpecificMappingsCB (or_mappings:Dict[str,Dict]={'DL': {3: 'ND',
                              1: '=', 2: '&lt;'}, 'FILT': {0: 'NA', 1: 'Y',
                              2: 'N'}},
                              output_format:str='openrefine_csv',
                              verbose:bool=False)</code></pre>
</blockquote>
<p><em>Convert values using OR mappings if columns exist in dataframe.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>or_mappings</td>
<td>Dict</td>
<td>{‘DL’: {3: ‘ND’, 1: ‘=’, 2: ‘&lt;’}, ‘FILT’: {0: ‘NA’, 1: ‘Y’, 2: ‘N’}}</td>
<td>Dictionary of column mappings,</td>
</tr>
<tr class="even">
<td>output_format</td>
<td>str</td>
<td>openrefine_csv</td>
<td></td>
</tr>
<tr class="odd">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span> contents.dfs,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        RemapToORSpecificMappingsCB(),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each group in the 'dfs' dictionary</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, df <span class="kw">in</span> tfm.dfs.items():</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the group dataframe contains any of the columns specified in or_mappings.keys()</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    relevant_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> or_mappings.keys() <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> relevant_columns:</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print the unique values from the relevant columns</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Unique values in </span><span class="sc">{</span>group_name<span class="sc">}</span><span class="ss"> for columns </span><span class="sc">{</span>relevant_columns<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> relevant_columns:</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>df[col]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"No relevant columns found in </span><span class="sc">{</span>group_name<span class="sc">}</span><span class="ss"> based on or_mappings keys."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique values in BIOTA for columns ['DL']:
DL: ['&lt;' '=' nan]

Unique values in SEAWATER for columns ['DL', 'FILT']:
DL: ['=' '&lt;' nan]
FILT: ['NA' 'N' 'Y']

Unique values in SEDIMENT for columns ['DL']:
DL: ['=' '&lt;' nan]</code></pre>
</div>
</div>
</section>
</section>
<section id="remap-to-csv-data-type-format" class="level2">
<h2 class="anchored" data-anchor-id="remap-to-csv-data-type-format">Remap to CSV data type format</h2>
<p><code>CSV_DTYPES</code> (defined in configs.ipynb) defines a state for each variable that contains a lookup table (i.e.&nbsp;enums). The state is either ‘decoded’ or ‘encoded’. Lets review the variable states as a DataFrame:</p>
<div id="cell-60" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>, <span class="st">'display.max_colwidth'</span>, <span class="va">None</span>):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    display(pd.DataFrame.from_dict(CSV_DTYPES, orient<span class="op">=</span><span class="st">'index'</span>).T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">FILT</th>
<th data-quarto-table-cell-role="th">COUNT_MET</th>
<th data-quarto-table-cell-role="th">SAMP_MET</th>
<th data-quarto-table-cell-role="th">PREP_MET</th>
<th data-quarto-table-cell-role="th">SPECIES</th>
<th data-quarto-table-cell-role="th">BODY_PART</th>
<th data-quarto-table-cell-role="th">SED_TYPE</th>
<th data-quarto-table-cell-role="th">LAB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">state</th>
<td>decoded</td>
<td>encoded</td>
<td>encoded</td>
<td>decoded</td>
<td>decoded</td>
<td>encoded</td>
<td>encoded</td>
<td>encoded</td>
<td>encoded</td>
<td>encoded</td>
<td>encoded</td>
<td>encoded</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-61" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>enums <span class="op">=</span> Enums(lut_src_dir<span class="op">=</span>lut_path())</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>enums.types.keys()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>dict_keys(['AREA', 'BIO_GROUP', 'BODY_PART', 'COUNT_MET', 'DL', 'FILT', 'NUCLIDE', 'PREP_MET', 'SAMP_MET', 'SED_TYPE', 'SPECIES', 'UNIT', 'LAB'])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L247" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_excluded_enums" class="level3">
<h3 class="anchored" data-anchor-id="get_excluded_enums">get_excluded_enums</h3>
<blockquote class="blockquote">
<pre><code> get_excluded_enums (output_format:str='openrefine_csv')</code></pre>
</blockquote>
<p><em>Get excluded enums based on output format.</em></p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L252" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dataformatconversioncb" class="level3">
<h3 class="anchored" data-anchor-id="dataformatconversioncb">DataFormatConversionCB</h3>
<blockquote class="blockquote">
<pre><code> DataFormatConversionCB (dtypes:Dict, excluded_mappings:Callable=&lt;function
                         get_excluded_enums&gt;,
                         output_format:str='openrefine_csv',
                         verbose:bool=False)</code></pre>
</blockquote>
<p><em>A callback to convert DataFrame enum values between encoded and decoded formats based on specified settings.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dtypes</td>
<td>Dict</td>
<td></td>
<td>Dictionary defining data types and states for each lookup table</td>
</tr>
<tr class="even">
<td>excluded_mappings</td>
<td>Callable</td>
<td>get_excluded_enums</td>
<td>Dictionary of columns to exclude from conversion</td>
</tr>
<tr class="odd">
<td>output_format</td>
<td>str</td>
<td>openrefine_csv</td>
<td></td>
</tr>
<tr class="even">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td>Flag for verbose output</td>
</tr>
</tbody>
</table>
<div id="cell-64" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    contents.dfs,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        RemoveNonCompatibleVariablesCB(<span class="bu">vars</span><span class="op">=</span>CSV_VARS, verbose<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        DataFormatConversionCB(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>            dtypes<span class="op">=</span>CSV_DTYPES,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>            excluded_mappings <span class="op">=</span> get_excluded_enums,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>            output_format<span class="op">=</span><span class="st">'openrefine_csv'</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>            verbose<span class="op">=</span><span class="va">True</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>tfm()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing variables that are not compatible with vars provided. 
Removing SMP_ID, BIO_GROUP from BIOTA dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEAWATER dataset.
Removing variables that are not compatible with vars provided. 
Removing SMP_ID from SEDIMENT dataset.
Loaded enums: dict_keys(['AREA', 'BIO_GROUP', 'BODY_PART', 'COUNT_MET', 'DL', 'FILT', 'NUCLIDE', 'PREP_MET', 'SAMP_MET', 'SED_TYPE', 'SPECIES', 'UNIT', 'LAB'])</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>{'BIOTA':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH        TIME  NUCLIDE  \
 0        BVTIG2012041  12.316667  54.283333        NaN  1348358400       31   
 1        BVTIG2012041  12.316667  54.283333        NaN  1348358400        4   
 2        BVTIG2012041  12.316667  54.283333        NaN  1348358400        9   
 3        BVTIG2012041  12.316667  54.283333        NaN  1348358400       33   
 4        BVTIG2012040  12.316667  54.283333        NaN  1348358400       31   
 ...               ...        ...        ...        ...         ...      ...   
 16089    BSTUK2022010  21.395000  61.241501        2.0  1652140800       33   
 16090    BSTUK2022010  21.395000  61.241501        2.0  1652140800        9   
 16091    BSTUK2022011  21.385000  61.343334        NaN  1663200000        4   
 16092    BSTUK2022011  21.385000  61.343334        NaN  1663200000       33   
 16093    BSTUK2022011  21.385000  61.343334        NaN  1663200000       12   
 
             VALUE  UNIT       UNC  DL  SPECIES  BODY_PART       DRYWT  WETWT  \
 0        0.010140     5       NaN   2       99         52  174.934433  948.0   
 1      135.300003     5  4.830210   1       99         52  174.934433  948.0   
 2        0.013980     5       NaN   2       99         52  174.934433  948.0   
 3        4.338000     5  0.150962   1       99         52  174.934433  948.0   
 4        0.009614     5       NaN   2       99         52  177.935120  964.0   
 ...           ...   ...       ...  ..      ...        ...         ...    ...   
 16089   13.700000     4  0.520600   1       96         55         NaN    NaN   
 16090    0.500000     4  0.045500   1       96         55         NaN    NaN   
 16091   50.700001     4  4.106700   1      129          1         NaN    NaN   
 16092    0.880000     4  0.140800   1      129          1         NaN    NaN   
 16093    6.600000     4  0.349800   1      129          1         NaN    NaN   
 
        PERCENTWT  
 0        0.18453  
 1        0.18453  
 2        0.18453  
 3        0.18453  
 4        0.18458  
 ...          ...  
 16089        NaN  
 16090        NaN  
 16091        NaN  
 16092        NaN  
 16093        NaN  
 
 [16094 rows x 15 columns],
 'SEAWATER':       SMP_ID_PROVIDER        LON        LAT  SMP_DEPTH  TOT_DEPTH        TIME  \
 0        WKRIL2012003  29.333300  60.083302        0.0        NaN  1337731200   
 1        WKRIL2012004  29.333300  60.083302       29.0        NaN  1337731200   
 2        WKRIL2012005  23.150000  59.433300        0.0        NaN  1339891200   
 3        WKRIL2012006  27.983299  60.250000        0.0        NaN  1337817600   
 4        WKRIL2012007  27.983299  60.250000       39.0        NaN  1337817600   
 ...               ...        ...        ...        ...        ...         ...   
 21468    WDHIG2023112  13.499833  54.600334        0.0       47.0  1686441600   
 21469    WDHIG2023113  13.499833  54.600334       45.0       47.0  1686441600   
 21470    WDHIG2023143  14.200833  54.600334        0.0       11.0  1686614400   
 21471    WDHIG2023145  14.665500  54.600334        0.0       20.0  1686614400   
 21472    WDHIG2023147  14.330000  54.600334        0.0       17.0  1686614400   
 
        NUCLIDE       VALUE  UNIT        UNC  DL  FILT  
 0           33    5.300000     1   1.696000   1     0  
 1           33   19.900000     1   3.980000   1     0  
 2           33   25.500000     1   5.100000   1     0  
 3           33   17.000000     1   4.930000   1     0  
 4           33   22.200001     1   3.996000   1     0  
 ...        ...         ...   ...        ...  ..   ...  
 21468        1  702.838074     1  51.276207   1     0  
 21469        1  725.855713     1  52.686260   1     0  
 21470        1  648.992920     1  48.154419   1     0  
 21471        1  627.178406     1  46.245316   1     0  
 21472        1  605.715088     1  45.691143   1     0  
 
 [21473 rows x 12 columns],
 'SEDIMENT':       SMP_ID_PROVIDER        LON        LAT  TOT_DEPTH        TIME  NUCLIDE  \
 0        SKRIL2012116  27.799999  60.466667       25.0  1337904000       33   
 1        SKRIL2012117  27.799999  60.466667       25.0  1337904000       33   
 2        SKRIL2012118  27.799999  60.466667       25.0  1337904000       33   
 3        SKRIL2012119  27.799999  60.466667       25.0  1337904000       33   
 4        SKRIL2012120  27.799999  60.466667       25.0  1337904000       33   
 ...               ...        ...        ...        ...         ...      ...   
 70444    SCLOR2022071  15.537800  54.617832       62.0  1654646400       67   
 70445    SCLOR2022071  15.537800  54.617832       62.0  1654646400       77   
 70446    SCLOR2022072  15.537800  54.617832       62.0  1654646400        4   
 70447    SCLOR2022072  15.537800  54.617832       62.0  1654646400       33   
 70448    SCLOR2022072  15.537800  54.617832       62.0  1654646400       77   
 
              VALUE  UNIT         UNC  DL  SED_TYPE   TOP  BOTTOM  PERCENTWT  
 0      1200.000000     3  240.000000   1         0  15.0    20.0        NaN  
 1       250.000000     3   50.000000   1         0  20.0    25.0        NaN  
 2       140.000000     3   29.400000   1         0  25.0    30.0        NaN  
 3        79.000000     3   15.800000   1         0  30.0    35.0        NaN  
 4        29.000000     3    6.960000   1         0  35.0    40.0        NaN  
 ...            ...   ...         ...  ..       ...   ...     ...        ...  
 70444     0.044000     2    0.015312   1        10  15.0    17.0   0.257642  
 70445     2.500000     2    0.185000   1        10  15.0    17.0   0.257642  
 70446  5873.000000     2  164.444000   1        10  17.0    19.0   0.263965  
 70447    21.200001     2    2.162400   1        10  17.0    19.0   0.263965  
 70448     0.370000     2    0.048100   1        10  17.0    19.0   0.263965  
 
 [70449 rows x 14 columns]}</code></pre>
</div>
</div>
</section>
</section>
<section id="review-all-callbacks" class="level2">
<h2 class="anchored" data-anchor-id="review-all-callbacks">Review all callbacks</h2>
<div id="cell-66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>contents <span class="op">=</span> ExtractNetcdfContents(fname_in)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>output_format <span class="op">=</span> <span class="st">'openrefine_csv'</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>contents.dfs,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    custom_maps<span class="op">=</span>contents.custom_maps,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    cbs<span class="op">=</span>[</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        ValidateEnumsCB(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>            contents <span class="op">=</span> contents,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            maris_enums<span class="op">=</span>Enums(lut_src_dir<span class="op">=</span>lut_path())</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        RemoveNonCompatibleVariablesCB(<span class="bu">vars</span><span class="op">=</span>CSV_VARS),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># SampleIDConversionCB(nonify=False),</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># RemapCustomMapsCB(),</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        RemapToORSpecificMappingsCB(output_format<span class="op">=</span>output_format),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        AddTaxonInformationCB(</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>            fn_lut<span class="op">=</span>lut_taxon</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        DecodeTimeCB(),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        AddSampleTypeIdColumnCB(),</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        AddZoteroArchiveLocationCB(contents.global_attrs, cfg<span class="op">=</span>cfg()),</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        DataFormatConversionCB(</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>            dtypes<span class="op">=</span>CSV_DTYPES,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>            excluded_mappings <span class="op">=</span> get_excluded_enums,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>            output_format<span class="op">=</span>output_format,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>tfm()</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grp <span class="kw">in</span> [<span class="st">'SEAWATER'</span>, <span class="st">'BIOTA'</span>]:</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    display(Markdown(<span class="ss">f"&lt;b&gt;Head of the transformed `</span><span class="sc">{</span>grp<span class="sc">}</span><span class="ss">` DataFrame:&lt;/b&gt;"</span>))</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> pd.option_context(<span class="st">'display.max_rows'</span>, <span class="va">None</span>):</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        display(tfm.dfs[grp].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><b>Head of the transformed <code>SEAWATER</code> DataFrame:</b></p>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SMP_ID_PROVIDER</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">TOT_DEPTH</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">FILT</th>
<th data-quarto-table-cell-role="th">SAMPLE_TYPE</th>
<th data-quarto-table-cell-role="th">REF_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>WKRIL2012003</td>
<td>29.333300</td>
<td>60.083302</td>
<td>0.0</td>
<td>NaN</td>
<td>2012-05-23</td>
<td>33</td>
<td>5.300000</td>
<td>1</td>
<td>1.696</td>
<td>=</td>
<td>NA</td>
<td>1</td>
<td>100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>WKRIL2012004</td>
<td>29.333300</td>
<td>60.083302</td>
<td>29.0</td>
<td>NaN</td>
<td>2012-05-23</td>
<td>33</td>
<td>19.900000</td>
<td>1</td>
<td>3.980</td>
<td>=</td>
<td>NA</td>
<td>1</td>
<td>100</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>WKRIL2012005</td>
<td>23.150000</td>
<td>59.433300</td>
<td>0.0</td>
<td>NaN</td>
<td>2012-06-17</td>
<td>33</td>
<td>25.500000</td>
<td>1</td>
<td>5.100</td>
<td>=</td>
<td>NA</td>
<td>1</td>
<td>100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>WKRIL2012006</td>
<td>27.983299</td>
<td>60.250000</td>
<td>0.0</td>
<td>NaN</td>
<td>2012-05-24</td>
<td>33</td>
<td>17.000000</td>
<td>1</td>
<td>4.930</td>
<td>=</td>
<td>NA</td>
<td>1</td>
<td>100</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>WKRIL2012007</td>
<td>27.983299</td>
<td>60.250000</td>
<td>39.0</td>
<td>NaN</td>
<td>2012-05-24</td>
<td>33</td>
<td>22.200001</td>
<td>1</td>
<td>3.996</td>
<td>=</td>
<td>NA</td>
<td>1</td>
<td>100</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><b>Head of the transformed <code>BIOTA</code> DataFrame:</b></p>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SMP_ID_PROVIDER</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">DRYWT</th>
<th data-quarto-table-cell-role="th">WETWT</th>
<th data-quarto-table-cell-role="th">PERCENTWT</th>
<th data-quarto-table-cell-role="th">TAXONNAME</th>
<th data-quarto-table-cell-role="th">TAXONRANK</th>
<th data-quarto-table-cell-role="th">TAXONDB</th>
<th data-quarto-table-cell-role="th">TAXONDBID</th>
<th data-quarto-table-cell-role="th">TAXONDBURL</th>
<th data-quarto-table-cell-role="th">SAMPLE_TYPE</th>
<th data-quarto-table-cell-role="th">REF_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>BVTIG2012041</td>
<td>12.316667</td>
<td>54.283333</td>
<td>NaN</td>
<td>2012-09-23</td>
<td>31</td>
<td>0.010140</td>
<td>5</td>
<td>NaN</td>
<td>&lt;</td>
<td>...</td>
<td>174.934433</td>
<td>948.0</td>
<td>0.18453</td>
<td>Gadus morhua</td>
<td>species</td>
<td>Wikidata</td>
<td>Q199788</td>
<td>https://www.wikidata.org/wiki/Q199788</td>
<td>2</td>
<td>100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>BVTIG2012041</td>
<td>12.316667</td>
<td>54.283333</td>
<td>NaN</td>
<td>2012-09-23</td>
<td>4</td>
<td>135.300003</td>
<td>5</td>
<td>4.830210</td>
<td>=</td>
<td>...</td>
<td>174.934433</td>
<td>948.0</td>
<td>0.18453</td>
<td>Gadus morhua</td>
<td>species</td>
<td>Wikidata</td>
<td>Q199788</td>
<td>https://www.wikidata.org/wiki/Q199788</td>
<td>2</td>
<td>100</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>BVTIG2012041</td>
<td>12.316667</td>
<td>54.283333</td>
<td>NaN</td>
<td>2012-09-23</td>
<td>9</td>
<td>0.013980</td>
<td>5</td>
<td>NaN</td>
<td>&lt;</td>
<td>...</td>
<td>174.934433</td>
<td>948.0</td>
<td>0.18453</td>
<td>Gadus morhua</td>
<td>species</td>
<td>Wikidata</td>
<td>Q199788</td>
<td>https://www.wikidata.org/wiki/Q199788</td>
<td>2</td>
<td>100</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>BVTIG2012041</td>
<td>12.316667</td>
<td>54.283333</td>
<td>NaN</td>
<td>2012-09-23</td>
<td>33</td>
<td>4.338000</td>
<td>5</td>
<td>0.150962</td>
<td>=</td>
<td>...</td>
<td>174.934433</td>
<td>948.0</td>
<td>0.18453</td>
<td>Gadus morhua</td>
<td>species</td>
<td>Wikidata</td>
<td>Q199788</td>
<td>https://www.wikidata.org/wiki/Q199788</td>
<td>2</td>
<td>100</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>BVTIG2012040</td>
<td>12.316667</td>
<td>54.283333</td>
<td>NaN</td>
<td>2012-09-23</td>
<td>31</td>
<td>0.009614</td>
<td>5</td>
<td>NaN</td>
<td>&lt;</td>
<td>...</td>
<td>177.935120</td>
<td>964.0</td>
<td>0.18458</td>
<td>Gadus morhua</td>
<td>species</td>
<td>Wikidata</td>
<td>Q199788</td>
<td>https://www.wikidata.org/wiki/Q199788</td>
<td>2</td>
<td>100</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
</section>
<section id="decode" class="level2">
<h2 class="anchored" data-anchor-id="decode">Decode</h2>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/netcdf2csv.py#L302" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="decode-1" class="level3">
<h3 class="anchored" data-anchor-id="decode-1">decode</h3>
<blockquote class="blockquote">
<pre><code> decode (fname_in:str, dest_out:str|None=None,
         output_format:str='openrefine_csv',
         remap_vars:Dict[str,str]={'LON': 'longitude', 'LAT': 'latitude',
         'SMP_DEPTH': 'sampdepth', 'TOT_DEPTH': 'totdepth', 'TIME':
         'begperiod', 'AREA': 'area', 'NUCLIDE': 'nuclide_id', 'VALUE':
         'activity', 'UNIT': 'unit_id', 'UNC': 'uncertaint', 'DL':
         'detection', 'DLV': 'detection_lim', 'FILT': 'filtered',
         'COUNT_MET': 'counmet_id', 'SAMP_MET': 'sampmet_id', 'PREP_MET':
         'prepmet_id', 'VOL': 'volume', 'SAL': 'salinity', 'TEMP':
         'temperatur', 'SPECIES': 'species_id', 'BODY_PART': 'bodypar_id',
         'SED_TYPE': 'sedtype_id', 'TOP': 'sliceup', 'BOTTOM':
         'slicedown', 'DRYWT': 'drywt', 'WETWT': 'wetwt', 'PERCENTWT':
         'percentwt', 'LAB': 'lab_id', 'PROFILE_ID': 'profile_id',
         'SAMPLE_TYPE': 'samptype_id', 'TAXONNAME': 'taxonname',
         'TAXONREPNAME': 'taxonrepname', 'TAXONRANK': 'taxonrank',
         'TAXONDB': 'taxondb', 'TAXONDBID': 'taxondb_id', 'TAXONDBURL':
         'taxondb_url', 'REF_ID': 'ref_id', 'SMP_ID_PROVIDER':
         'samplabcode', 'STATION': 'station'},
         remap_dtypes:Dict[str,str]={'AREA': {'state': 'decoded'},
         'NUCLIDE': {'state': 'encoded'}, 'UNIT': {'state': 'encoded'},
         'DL': {'state': 'decoded'}, 'FILT': {'state': 'decoded'},
         'COUNT_MET': {'state': 'encoded'}, 'SAMP_MET': {'state':
         'encoded'}, 'PREP_MET': {'state': 'encoded'}, 'SPECIES':
         {'state': 'encoded'}, 'BODY_PART': {'state': 'encoded'},
         'SED_TYPE': {'state': 'encoded'}, 'LAB': {'state': 'encoded'}},
         verbose:bool=False, **kwargs)</code></pre>
</blockquote>
<p><em>Decode data from NetCDF.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fname_in</td>
<td>str</td>
<td></td>
<td>Input file name</td>
</tr>
<tr class="even">
<td>dest_out</td>
<td>str | None</td>
<td>None</td>
<td>Output file name (optional)</td>
</tr>
<tr class="odd">
<td>output_format</td>
<td>str</td>
<td>openrefine_csv</td>
<td>Output format</td>
</tr>
<tr class="even">
<td>remap_vars</td>
<td>Dict</td>
<td>{‘LON’: ‘longitude’, ‘LAT’: ‘latitude’, ‘SMP_DEPTH’: ‘sampdepth’, ‘TOT_DEPTH’: ‘totdepth’, ‘TIME’: ‘begperiod’, ‘AREA’: ‘area’, ‘NUCLIDE’: ‘nuclide_id’, ‘VALUE’: ‘activity’, ‘UNIT’: ‘unit_id’, ‘UNC’: ‘uncertaint’, ‘DL’: ‘detection’, ‘DLV’: ‘detection_lim’, ‘FILT’: ‘filtered’, ‘COUNT_MET’: ‘counmet_id’, ‘SAMP_MET’: ‘sampmet_id’, ‘PREP_MET’: ‘prepmet_id’, ‘VOL’: ‘volume’, ‘SAL’: ‘salinity’, ‘TEMP’: ‘temperatur’, ‘SPECIES’: ‘species_id’, ‘BODY_PART’: ‘bodypar_id’, ‘SED_TYPE’: ‘sedtype_id’, ‘TOP’: ‘sliceup’, ‘BOTTOM’: ‘slicedown’, ‘DRYWT’: ‘drywt’, ‘WETWT’: ‘wetwt’, ‘PERCENTWT’: ‘percentwt’, ‘LAB’: ‘lab_id’, ‘PROFILE_ID’: ‘profile_id’, ‘SAMPLE_TYPE’: ‘samptype_id’, ‘TAXONNAME’: ‘taxonname’, ‘TAXONREPNAME’: ‘taxonrepname’, ‘TAXONRANK’: ‘taxonrank’, ‘TAXONDB’: ‘taxondb’, ‘TAXONDBID’: ‘taxondb_id’, ‘TAXONDBURL’: ‘taxondb_url’, ‘REF_ID’: ‘ref_id’, ‘SMP_ID_PROVIDER’: ‘samplabcode’, ‘STATION’: ‘station’}</td>
<td>Mapping of OR vars to NC vars</td>
</tr>
<tr class="odd">
<td>remap_dtypes</td>
<td>Dict</td>
<td>{‘AREA’: {‘state’: ‘decoded’}, ‘NUCLIDE’: {‘state’: ‘encoded’}, ‘UNIT’: {‘state’: ‘encoded’}, ‘DL’: {‘state’: ‘decoded’}, ‘FILT’: {‘state’: ‘decoded’}, ‘COUNT_MET’: {‘state’: ‘encoded’}, ‘SAMP_MET’: {‘state’: ‘encoded’}, ‘PREP_MET’: {‘state’: ‘encoded’}, ‘SPECIES’: {‘state’: ‘encoded’}, ‘BODY_PART’: {‘state’: ‘encoded’}, ‘SED_TYPE’: {‘state’: ‘encoded’}, ‘LAB’: {‘state’: ‘encoded’}}</td>
<td>Mapping of OR vars to NC dtypes</td>
</tr>
<tr class="even">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td>If True, print verbose output</td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
<td><strong>Additional arguments</strong></td>
</tr>
</tbody>
</table>
<div id="cell-69" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> Path(<span class="st">'../../_data/output/100-HELCOM-MORS-2024.nc'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>decode(fname_in<span class="op">=</span>fname, dest_out<span class="op">=</span>fname.with_suffix(<span class="st">''</span>), output_format<span class="op">=</span><span class="st">'openrefine_csv'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/franckalbinet\.github\.io\/marisco");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/franckalbinet/marisco/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
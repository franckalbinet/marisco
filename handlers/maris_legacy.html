<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MARIS Legacy – marisco</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-cd333c7267348b54b15a9ec2a617d176.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="MARIS Legacy – marisco">
<meta property="og:description" content="MARIS companion package and tutorials">
<meta property="og:site_name" content="marisco">
<meta name="twitter:title" content="MARIS Legacy – marisco">
<meta name="twitter:description" content="MARIS companion package and tutorials">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">marisco</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/franckalbinet/marisco"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../handlers/helcom.html">Handlers</a></li><li class="breadcrumb-item"><a href="../handlers/maris_legacy.html">MARIS Legacy</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MARISCO</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Handlers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/helcom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HELCOM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/ospar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OSPAR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/geotraces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geotraces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/maris_legacy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">MARIS Legacy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handlers/tepco.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEPCO</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/callbacks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Callbacks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/configs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/encoders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Encoders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/decoders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decoders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/netcdf2csv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NetCDF2CSV</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../metadata/data-curation-rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data curation rules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../metadata/field-definition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Field definitions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configuration-file-paths" id="toc-configuration-file-paths" class="nav-link active" data-scroll-target="#configuration-file-paths">Configuration &amp; file paths</a></li>
  <li><a href="#utils" id="toc-utils" class="nav-link" data-scroll-target="#utils">Utils</a>
  <ul>
  <li><a href="#dataloader" id="toc-dataloader" class="nav-link" data-scroll-target="#dataloader">DataLoader</a></li>
  <li><a href="#get_zotero_key" id="toc-get_zotero_key" class="nav-link" data-scroll-target="#get_zotero_key">get_zotero_key</a></li>
  <li><a href="#get_fname" id="toc-get_fname" class="nav-link" data-scroll-target="#get_fname">get_fname</a></li>
  </ul></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#transform-data" id="toc-transform-data" class="nav-link" data-scroll-target="#transform-data">Transform data</a>
  <ul>
  <li><a href="#select-columns" id="toc-select-columns" class="nav-link" data-scroll-target="#select-columns">Select columns</a></li>
  <li><a href="#rename-columns" id="toc-rename-columns" class="nav-link" data-scroll-target="#rename-columns">Rename columns</a></li>
  <li><a href="#cast-station-to-str-type" id="toc-cast-station-to-str-type" class="nav-link" data-scroll-target="#cast-station-to-str-type">Cast <code>STATION</code> to <code>str</code> type</a></li>
  <li><a href="#caststationtostringcb" id="toc-caststationtostringcb" class="nav-link" data-scroll-target="#caststationtostringcb">CastStationToStringCB</a></li>
  <li><a href="#drop-nan-only-columns" id="toc-drop-nan-only-columns" class="nav-link" data-scroll-target="#drop-nan-only-columns">Drop NaN only columns</a></li>
  <li><a href="#dropnacolumnscb" id="toc-dropnacolumnscb" class="nav-link" data-scroll-target="#dropnacolumnscb">DropNAColumnsCB</a></li>
  <li><a href="#remap-detection-limit-values" id="toc-remap-detection-limit-values" class="nav-link" data-scroll-target="#remap-detection-limit-values">Remap detection limit values</a></li>
  <li><a href="#sanitizedetectionlimitcb" id="toc-sanitizedetectionlimitcb" class="nav-link" data-scroll-target="#sanitizedetectionlimitcb">SanitizeDetectionLimitCB</a></li>
  <li><a href="#parse-and-encode-time" id="toc-parse-and-encode-time" class="nav-link" data-scroll-target="#parse-and-encode-time">Parse and encode time</a></li>
  <li><a href="#parsetimecb" id="toc-parsetimecb" class="nav-link" data-scroll-target="#parsetimecb">ParseTimeCB</a></li>
  <li><a href="#sanitize-coordinates" id="toc-sanitize-coordinates" class="nav-link" data-scroll-target="#sanitize-coordinates">Sanitize coordinates</a></li>
  <li><a href="#set-unique-index" id="toc-set-unique-index" class="nav-link" data-scroll-target="#set-unique-index">Set unique index</a></li>
  </ul></li>
  <li><a href="#encode-to-netcdf" id="toc-encode-to-netcdf" class="nav-link" data-scroll-target="#encode-to-netcdf">Encode to NetCDF</a>
  <ul>
  <li><a href="#get_attrs" id="toc-get_attrs" class="nav-link" data-scroll-target="#get_attrs">get_attrs</a></li>
  <li><a href="#encode" id="toc-encode" class="nav-link" data-scroll-target="#encode">encode</a></li>
  <li><a href="#single-dataset" id="toc-single-dataset" class="nav-link" data-scroll-target="#single-dataset">Single dataset</a></li>
  <li><a href="#all-datasets" id="toc-all-datasets" class="nav-link" data-scroll-target="#all-datasets">All datasets</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/franckalbinet/marisco/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../handlers/helcom.html">Handlers</a></li><li class="breadcrumb-item"><a href="../handlers/maris_legacy.html">MARIS Legacy</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">MARIS Legacy</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<blockquote class="blockquote">
<p>This data pipeline, known as “handler” in Marisco terminology, contains a data pipeline (handler) that converts the master MARIS database dump into <code>NetCDF</code> format. It enables batch encoding of all legacy datasets into NetCDF.</p>
</blockquote>
<p>Key functions of this handler:</p>
<ul>
<li><strong>Load data</strong> from a MARIS dump file</li>
<li><strong>Transform data</strong> by applying various transformations to clean and normalize the data</li>
<li><strong>Encode data</strong> into NetCDF files</li>
</ul>
<p>The <strong>result</strong> is a set of NetCDF files, one for each unique reference ID in the input data.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Getting Started
</div>
</div>
<div class="callout-body-container callout-body">
<p>For new MARIS users, please refer to <a href="https://github.com/franckalbinet/marisco/tree/main/install_configure_guide">Understanding MARIS Data Formats (NetCDF and Open Refine)</a> for detailed information.</p>
</div>
</div>
<p>The present notebook pretends to be an instance of <a href="https://www.wikiwand.com/en/articles/Literate_programming">Literate Programming</a> in the sense that it is a narrative that includes code snippets that are interspersed with explanations. When a function or a class needs to be exported in a dedicated python module (in our case <code>marisco/handlers/helcom.py</code>) the code snippet is added to the module using <code>#| exports</code> as provided by the wonderful <a href="https://nbdev.readthedocs.io/en/latest/">nbdev</a> library.</p>
<section id="configuration-file-paths" class="level2">
<h2 class="anchored" data-anchor-id="configuration-file-paths">Configuration &amp; file paths</h2>
<ul>
<li><p><strong>fname_in</strong>: path to the folder containing the MARIS dump data in CSV format.</p></li>
<li><p><strong>dir_dest</strong>: path to the folder where the NetCDF output will be saved.</p></li>
</ul>
<div id="d02bf0a9" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fname_in = Path().home() / 'pro/data/maris/2024-11-20 MARIS_QA_shapetype_id=1.txt'</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fname_in <span class="op">=</span> Path().home() <span class="op">/</span> <span class="st">'pro/data/maris/2025-06-03 MARIS_QA_shapetype_id = 1.txt'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dir_dest <span class="op">=</span> <span class="st">'../../_data/output/dump'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="eec0fa87" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(fname_in, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fc64e0ee" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df[df.ref_id <span class="op">==</span> <span class="dv">160</span>].iloc[<span class="dv">0</span>].zoterourl</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'https://www.zotero.org/groups/2432820/maris/items/2DG8PM5Q'</code></pre>
</div>
</div>
<div id="65e73277" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df[df.ref_id <span class="op">==</span> <span class="dv">160</span>].iloc[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>sample_id                                                        419906
area_id                                                            4279
areaname                              Mediterranean Sea - Western Basin
samptype_id                                                           1
samptype                                                       Seawater
ref_id                                                              160
displaytext                                           Pham et al., 2010
zoterourl             https://www.zotero.org/groups/2432820/maris/it...
ref_note                                                            NaN
datbase                                                             NaN
lab_id                                                                0
lab                                                       NOT AVAILABLE
latitude                                                      43.418611
longitude                                                      7.833889
begperiod                                       2001-02-18 00:00:00.000
endperiod                                                           NaN
samplingyear                                                       2001
totdepth                                                            NaN
sampdepth                                                           0.0
station                                                         DYFAMED
samplabcode                                                           1
species_id                                                            0
taxonname                                               (Not available)
taxonrank                                                           NaN
biogroup                                                (Not available)
biogroup_id                                                           0
taxondb                                                             NaN
taxondbid                                                           NaN
taxondburl                                                          NaN
taxonrepname                                                        NaN
bodypar_id                                                            0
bodypar                                                 (Not available)
sliceup                                                             NaN
slicedown                                                           NaN
sedtype_id                                                            0
sedtype                                                 (Not available)
sedrepname                                                          NaN
nuclide_id                                                           28
nusymbol                                                          I-129
volume                                                              NaN
salinity                                                            NaN
temperatur                                                          NaN
filtered                                                              Y
filtpore                                                            NaN
samparea                                                            NaN
drywt                                                               NaN
wetwt                                                               NaN
percentwt                                                           NaN
sampmet_id                                                            1
sampmet                                                 Bottle sampling
prepmet_id                                                            0
prepmet                                                   Not available
drymet_id                                                             0
drymet                                                    Not available
counmet_id                                                            7
counmet                                   Accelerator mass spectrometry
decayedto                                                           NaN
detection                                                             =
activity                                                       0.000319
uncertaint                                                     0.000009
unit_id                                                               1
unit                                                              Bq/m3
vartype                                                             NaN
freq                                                                NaN
rangelow                                                            NaN
rangeupp                                                            NaN
profile                                                             NaN
transect_id                                                         NaN
measure_note                                                        AMS
shapetype_id                                                          1
profile_id                                                          NaN
sampnote              No sampling depth in the paper. According to t...
ref_fulltext          Pham, M.K., Betti, M., Povinec, P.P., Alfimov,...
ref_yearpub                                                        2010
ref_sampleTypes                                                       1
LongLat                                                    7.834,43.419
shiftedcoordinates       0xE6100000010C840D4FAF94B5454084D89942E7551F40
shiftedlong                                                    7.833889
shiftedlat                                                    43.418611
id                                                               806966
Name: 806965, dtype: object</code></pre>
</div>
</div>
<div id="e07d6f18" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sample_id</th>
<th data-quarto-table-cell-role="th">area_id</th>
<th data-quarto-table-cell-role="th">areaname</th>
<th data-quarto-table-cell-role="th">samptype_id</th>
<th data-quarto-table-cell-role="th">samptype</th>
<th data-quarto-table-cell-role="th">ref_id</th>
<th data-quarto-table-cell-role="th">displaytext</th>
<th data-quarto-table-cell-role="th">zoterourl</th>
<th data-quarto-table-cell-role="th">ref_note</th>
<th data-quarto-table-cell-role="th">datbase</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">profile_id</th>
<th data-quarto-table-cell-role="th">sampnote</th>
<th data-quarto-table-cell-role="th">ref_fulltext</th>
<th data-quarto-table-cell-role="th">ref_yearpub</th>
<th data-quarto-table-cell-role="th">ref_sampleTypes</th>
<th data-quarto-table-cell-role="th">LongLat</th>
<th data-quarto-table-cell-role="th">shiftedcoordinates</th>
<th data-quarto-table-cell-role="th">shiftedlong</th>
<th data-quarto-table-cell-role="th">shiftedlat</th>
<th data-quarto-table-cell-role="th">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>18810</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>97</td>
<td>ASPAMARD, 2004</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>P. Scotto(1975-2001);P. Morris (2003-2014)</td>
<td>ASPAMARD</td>
<td>...</td>
<td>NaN</td>
<td>Because the date does not have month &amp; day, an...</td>
<td>ASPAMARD, 2004. Asia-Pacific Marine Radioactiv...</td>
<td>2004</td>
<td>1,3</td>
<td>111.983,-25.05</td>
<td>0xE6100000010CCDCCCCCCCC0C39C0F4FDD478E9FE5B40</td>
<td>111.983333</td>
<td>-25.050000</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>63633</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>99</td>
<td>Aoyama and Hirose, 2004</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>HAM 2008</td>
<td>...</td>
<td>NaN</td>
<td>Author: Y.Bourlat, et.al. Unknown latitude and...</td>
<td>Aoyama, M., Hirose, K., 2004. HAM 2008 - Histo...</td>
<td>2004</td>
<td>1</td>
<td>61.533,-52.017</td>
<td>0xE6100000010CEEEBC03923024AC0787AA52C43C44E40</td>
<td>61.533333</td>
<td>-52.016667</td>
<td>2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>63633</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>99</td>
<td>Aoyama and Hirose, 2004</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>HAM 2008</td>
<td>...</td>
<td>NaN</td>
<td>Author: Y.Bourlat, et.al. Unknown latitude and...</td>
<td>Aoyama, M., Hirose, K., 2004. HAM 2008 - Histo...</td>
<td>2004</td>
<td>1</td>
<td>61.533,-52.017</td>
<td>0xE6100000010CEEEBC03923024AC0787AA52C43C44E40</td>
<td>61.533333</td>
<td>-52.016667</td>
<td>3</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>63635</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>99</td>
<td>Aoyama and Hirose, 2004</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>HAM 2008</td>
<td>...</td>
<td>NaN</td>
<td>Author: Y.Bourlat, et.al. Unknown latitude and...</td>
<td>Aoyama, M., Hirose, K., 2004. HAM 2008 - Histo...</td>
<td>2004</td>
<td>1</td>
<td>57.483,-44.483</td>
<td>0xE6100000010C12143FC6DC3D46C012143FC6DCBD4C40</td>
<td>57.483333</td>
<td>-44.483333</td>
<td>4</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>63635</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>99</td>
<td>Aoyama and Hirose, 2004</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>HAM 2008</td>
<td>...</td>
<td>NaN</td>
<td>Author: Y.Bourlat, et.al. Unknown latitude and...</td>
<td>Aoyama, M., Hirose, K., 2004. HAM 2008 - Histo...</td>
<td>2004</td>
<td>1</td>
<td>57.483,-44.483</td>
<td>0xE6100000010C12143FC6DC3D46C012143FC6DCBD4C40</td>
<td>57.483333</td>
<td>-44.483333</td>
<td>5</td>
</tr>
</tbody>
</table>

<p>5 rows × 80 columns</p>
</div>
</div>
</div>
</section>
<section id="utils" class="level2">
<h2 class="anchored" data-anchor-id="utils">Utils</h2>
<p>Below a utility class to load a specific MARIS dump dataset optionally filtered through its <code>ref_id</code>.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L55" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dataloader" class="level3">
<h3 class="anchored" data-anchor-id="dataloader">DataLoader</h3>
<blockquote class="blockquote">
<pre><code> DataLoader (fname:str, exclude_ref_id:Optional[List[int]]=[9999])</code></pre>
</blockquote>
<p><em>Load specific MARIS dataset through its ref_id.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fname</td>
<td>str</td>
<td></td>
<td>Path to the MARIS global dump file</td>
</tr>
<tr class="even">
<td>exclude_ref_id</td>
<td>Optional</td>
<td>[9999]</td>
<td>Whether to filter the dataframe by ref_id</td>
</tr>
</tbody>
</table>
<div id="b76e4cad" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataLoader:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Load specific MARIS dataset through its ref_id."</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    LUT <span class="op">=</span> {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Biota'</span>: <span class="st">'BIOTA'</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Seawater'</span>: <span class="st">'SEAWATER'</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sediment'</span>: <span class="st">'SEDIMENT'</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Suspended matter'</span>: <span class="st">'SUSPENDED_MATTER'</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                 fname: <span class="bu">str</span>, <span class="co"># Path to the MARIS global dump file</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                 exclude_ref_id: Optional[List[<span class="bu">int</span>]]<span class="op">=</span>[<span class="dv">9999</span>] <span class="co"># Whether to filter the dataframe by ref_id</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                 ):</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        fc.store_attr()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> <span class="va">self</span>._load_data()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_data(<span class="va">self</span>):</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(<span class="va">self</span>.fname, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df[<span class="op">~</span>df.ref_id.isin(<span class="va">self</span>.exclude_ref_id)] <span class="cf">if</span> <span class="va">self</span>.exclude_ref_id <span class="cf">else</span> df</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                 ref_id: <span class="bu">int</span> <span class="co"># Reference ID of interest</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                 ) <span class="op">-&gt;</span> <span class="bu">dict</span>: <span class="co"># Dictionary of dataframes</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.df.ref_id <span class="op">==</span> ref_id].copy() <span class="cf">if</span> ref_id <span class="cf">else</span> <span class="va">self</span>.df.copy()</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="va">self</span>.LUT[name]: grp <span class="cf">for</span> name, grp <span class="kw">in</span> df.groupby(<span class="st">'samptype'</span>) <span class="cf">if</span> name <span class="kw">in</span> <span class="va">self</span>.LUT}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L82" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_zotero_key" class="level3">
<h3 class="anchored" data-anchor-id="get_zotero_key">get_zotero_key</h3>
<blockquote class="blockquote">
<pre><code> get_zotero_key (dfs)</code></pre>
</blockquote>
<p><em>Retrieve Zotero key from MARIS dump.</em></p>
<div id="09e988c3" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_zotero_key(dfs):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Retrieve Zotero key from MARIS dump."</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dfs[<span class="bu">next</span>(<span class="bu">iter</span>(dfs))][[<span class="st">'zoterourl'</span>]].iloc[<span class="dv">0</span>].values[<span class="dv">0</span>].split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L87" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_fname" class="level3">
<h3 class="anchored" data-anchor-id="get_fname">get_fname</h3>
<blockquote class="blockquote">
<pre><code> get_fname (dfs)</code></pre>
</blockquote>
<p><em>Get NetCDF filename.</em></p>
<div id="7fd56197" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_fname(dfs):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get NetCDF filename."</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">next</span>(<span class="bu">iter</span>(dfs.values()))[<span class="st">'ref_id'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">.nc"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<p>Here below a quick overview of the MARIS dump data structure.</p>
<div id="333c1cc3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dataloader <span class="op">=</span> DataLoader(fname_in)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ref_id <span class="op">=</span> <span class="dv">106</span> <span class="co"># Some other ref_id examples: OSPAR: 191, HELCOM: 100, 717 (only seawater)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'keys: </span><span class="sc">{</span>dfs<span class="sc">.</span>keys()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">'SEAWATER'</span>].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>keys: dict_keys(['SEAWATER'])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sample_id</th>
<th data-quarto-table-cell-role="th">area_id</th>
<th data-quarto-table-cell-role="th">areaname</th>
<th data-quarto-table-cell-role="th">samptype_id</th>
<th data-quarto-table-cell-role="th">samptype</th>
<th data-quarto-table-cell-role="th">ref_id</th>
<th data-quarto-table-cell-role="th">displaytext</th>
<th data-quarto-table-cell-role="th">zoterourl</th>
<th data-quarto-table-cell-role="th">ref_note</th>
<th data-quarto-table-cell-role="th">datbase</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">profile_id</th>
<th data-quarto-table-cell-role="th">sampnote</th>
<th data-quarto-table-cell-role="th">ref_fulltext</th>
<th data-quarto-table-cell-role="th">ref_yearpub</th>
<th data-quarto-table-cell-role="th">ref_sampleTypes</th>
<th data-quarto-table-cell-role="th">LongLat</th>
<th data-quarto-table-cell-role="th">shiftedcoordinates</th>
<th data-quarto-table-cell-role="th">shiftedlong</th>
<th data-quarto-table-cell-role="th">shiftedlat</th>
<th data-quarto-table-cell-role="th">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">5829</th>
<td>73703</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>106</td>
<td>Yamada et al., 2006</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>Yamada, M., Zheng, J., Wang, Z.-L., 2006. 137C...</td>
<td>2006</td>
<td>1</td>
<td>92.983,-0.008</td>
<td>0xE6100000010CB289C4EB97DB7FBFA52C431CEB3E5740</td>
<td>92.983056</td>
<td>-0.007778</td>
<td>5830</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5830</th>
<td>73705</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>106</td>
<td>Yamada et al., 2006</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>Yamada, M., Zheng, J., Wang, Z.-L., 2006. 137C...</td>
<td>2006</td>
<td>1</td>
<td>96.596,-4.029</td>
<td>0xE6100000010CAF5A99F04B1D10C0D95F764F1E265840</td>
<td>96.595556</td>
<td>-4.028611</td>
<td>5831</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5831</th>
<td>73711</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>106</td>
<td>Yamada et al., 2006</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>Yamada, M., Zheng, J., Wang, Z.-L., 2006. 137C...</td>
<td>2006</td>
<td>1</td>
<td>101.991,-9.997</td>
<td>0xE6100000010C91D5AD9E93FE23C08195438B6C7F5940</td>
<td>101.990556</td>
<td>-9.997222</td>
<td>5832</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5832</th>
<td>73715</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>106</td>
<td>Yamada et al., 2006</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>Yamada, M., Zheng, J., Wang, Z.-L., 2006. 137C...</td>
<td>2006</td>
<td>1</td>
<td>114.394,-18.496</td>
<td>0xE6100000010C575BB1BFEC7E32C0F0A7C64B37995C40</td>
<td>114.393889</td>
<td>-18.495833</td>
<td>5833</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5833</th>
<td>73717</td>
<td>1904</td>
<td>Indian Ocean</td>
<td>1</td>
<td>Seawater</td>
<td>106</td>
<td>Yamada et al., 2006</td>
<td>https://www.zotero.org/groups/2432820/maris/it...</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>Yamada, M., Zheng, J., Wang, Z.-L., 2006. 137C...</td>
<td>2006</td>
<td>1</td>
<td>112.552,-23.066</td>
<td>0xE6100000010C54742497FF1037C017D9CEF753235C40</td>
<td>112.551667</td>
<td>-23.066389</td>
<td>5834</td>
</tr>
</tbody>
</table>

<p>5 rows × 80 columns</p>
</div>
</div>
</div>
</section>
<section id="transform-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-data">Transform data</h2>
<section id="select-columns" class="level3">
<h3 class="anchored" data-anchor-id="select-columns">Select columns</h3>
<div id="e72d5b55" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cois_renaming_rules <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sample_id'</span>: <span class="st">'SMP_ID'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'latitude'</span>: <span class="st">'LAT'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'longitude'</span>: <span class="st">'LON'</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'begperiod'</span>: <span class="st">'TIME'</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sampdepth'</span>: <span class="st">'SMP_DEPTH'</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'totdepth'</span>: <span class="st">'TOT_DEPTH'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'station'</span>: <span class="st">'STATION'</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncertaint'</span>: <span class="st">'UNC'</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'unit_id'</span>: <span class="st">'UNIT'</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'detection'</span>: <span class="st">'DL'</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'area_id'</span>: <span class="st">'AREA'</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'species_id'</span>: <span class="st">'SPECIES'</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'biogroup_id'</span>: <span class="st">'BIO_GROUP'</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bodypar_id'</span>: <span class="st">'BODY_PART'</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sedtype_id'</span>: <span class="st">'SED_TYPE'</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'volume'</span>: <span class="st">'VOL'</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'salinity'</span>: <span class="st">'SAL'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'temperatur'</span>: <span class="st">'TEMP'</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sampmet_id'</span>: <span class="st">'SAMP_MET'</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'prepmet_id'</span>: <span class="st">'PREP_MET'</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'counmet_id'</span>: <span class="st">'COUNT_MET'</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'activity'</span>: <span class="st">'VALUE'</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nuclide_id'</span>: <span class="st">'NUCLIDE'</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sliceup'</span>: <span class="st">'TOP'</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'slicedown'</span>: <span class="st">'BOTTOM'</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="79a00835" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Keys:'</span>, tfm().keys())</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Columns:'</span>, tfm()[<span class="st">'SEAWATER'</span>].columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys: dict_keys(['SEAWATER'])
Columns: Index(['sample_id', 'latitude', 'longitude', 'begperiod', 'sampdepth',
       'totdepth', 'station', 'uncertaint', 'unit_id', 'detection', 'area_id',
       'species_id', 'biogroup_id', 'bodypar_id', 'sedtype_id', 'volume',
       'salinity', 'temperatur', 'sampmet_id', 'prepmet_id', 'counmet_id',
       'activity', 'nuclide_id', 'sliceup', 'slicedown'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="rename-columns" class="level3">
<h3 class="anchored" data-anchor-id="rename-columns">Rename columns</h3>
<div id="0e5068a9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>dfs_tfm <span class="op">=</span> tfm()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Keys:'</span>, dfs_tfm.keys())</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Columns:'</span>, dfs_tfm[<span class="st">'SEAWATER'</span>].columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys: dict_keys(['SEAWATER'])
Columns: Index(['SMP_ID', 'LAT', 'LON', 'TIME', 'SMP_DEPTH', 'TOT_DEPTH', 'STATION',
       'UNC', 'UNIT', 'DL', 'AREA', 'SPECIES', 'BIO_GROUP', 'BODY_PART',
       'SED_TYPE', 'VOL', 'SAL', 'TEMP', 'SAMP_MET', 'PREP_MET', 'COUNT_MET',
       'VALUE', 'NUCLIDE', 'TOP', 'BOTTOM'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="cast-station-to-str-type" class="level3">
<h3 class="anchored" data-anchor-id="cast-station-to-str-type">Cast <code>STATION</code> to <code>str</code> type</h3>
<p>This is required for <code>VLEN</code> netcdf variables.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L121" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="caststationtostringcb" class="level3">
<h3 class="anchored" data-anchor-id="caststationtostringcb">CastStationToStringCB</h3>
<blockquote class="blockquote">
<pre><code> CastStationToStringCB ()</code></pre>
</blockquote>
<p><em>Convert STATION column to string type, filling any missing values with empty string</em></p>
<div id="178e3892" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CastStationToStringCB(Callback):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Convert STATION column to string type, filling any missing values with empty string"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, tfm):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> tfm.dfs.keys():</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'STATION'</span> <span class="kw">in</span> tfm.dfs[k].columns:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                tfm.dfs[k][<span class="st">'STATION'</span>] <span class="op">=</span> tfm.dfs[k][<span class="st">'STATION'</span>].fillna(<span class="st">''</span>).astype(<span class="st">'string'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="9cf25214" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>dfs_tfm <span class="op">=</span> tfm()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Keys:'</span>, dfs_tfm.keys())</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Columns:'</span>, dfs_tfm[<span class="st">'SEAWATER'</span>].dtypes)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys: dict_keys(['SEAWATER'])
Columns: SMP_ID                int64
LAT                 float64
LON                 float64
TIME                 object
SMP_DEPTH           float64
TOT_DEPTH           float64
STATION      string[python]
UNC                 float64
UNIT                  int64
DL                   object
AREA                  int64
SPECIES               int64
BIO_GROUP             int64
BODY_PART             int64
SED_TYPE              int64
VOL                 float64
SAL                 float64
TEMP                float64
SAMP_MET              int64
PREP_MET              int64
COUNT_MET             int64
VALUE               float64
NUCLIDE               int64
TOP                 float64
BOTTOM              float64
dtype: object</code></pre>
</div>
</div>
</section>
<section id="drop-nan-only-columns" class="level3">
<h3 class="anchored" data-anchor-id="drop-nan-only-columns">Drop NaN only columns</h3>
<p>We then remove columns containing only NaN values or ‘Not available’ (id=0 in MARIS lookup tables).</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L129" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dropnacolumnscb" class="level3">
<h3 class="anchored" data-anchor-id="dropnacolumnscb">DropNAColumnsCB</h3>
<blockquote class="blockquote">
<pre><code> DropNAColumnsCB (na_value=0)</code></pre>
</blockquote>
<p><em>Drop variable containing only NaN or ‘Not available’ (id=0 in MARIS lookup tables).</em></p>
<div id="819703e6" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DropNAColumnsCB(Callback):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Drop variable containing only NaN or 'Not available' (id=0 in MARIS lookup tables)."</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, na_value<span class="op">=</span><span class="dv">0</span>): fc.store_attr()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> isMarisNA(<span class="va">self</span>, col): </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(col.unique()) <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> col.iloc[<span class="dv">0</span>] <span class="op">==</span> <span class="va">self</span>.na_value</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dropMarisNA(<span class="va">self</span>, df):</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        na_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="va">self</span>.isMarisNA(df[col])]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df.drop(labels<span class="op">=</span>na_cols, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, tfm):</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> tfm.dfs.keys():</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            tfm.dfs[k] <span class="op">=</span> tfm.dfs[k].dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            tfm.dfs[k] <span class="op">=</span> <span class="va">self</span>.dropMarisNA(tfm.dfs[k])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="9e0f69f1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>dfs_tfm <span class="op">=</span> tfm()</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Keys:'</span>, dfs_tfm.keys())</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Columns:'</span>, dfs_tfm[<span class="st">'SEAWATER'</span>].columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys: dict_keys(['SEAWATER'])
Columns: Index(['SMP_ID', 'LAT', 'LON', 'TIME', 'STATION', 'UNC', 'UNIT', 'DL', 'AREA',
       'SAL', 'TEMP', 'VALUE', 'NUCLIDE'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="remap-detection-limit-values" class="level3">
<h3 class="anchored" data-anchor-id="remap-detection-limit-values">Remap detection limit values</h3>
<p>Category-based <code>NetCDF</code> variables are encoded as integer values based on the MARIS lookup table <code>dbo_detectlimit.xlsx</code>. We recall that these lookup tables are included in the <code>NetCDF</code> file as custom enumeration types.</p>
<div id="5f143484" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dl_name_to_id <span class="op">=</span> <span class="kw">lambda</span>: get_lut(lut_path(), </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'dbo_detectlimit.xlsx'</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                                key<span class="op">=</span><span class="st">'name'</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                                value<span class="op">=</span><span class="st">'id'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="c1530475" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dl_name_to_id()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'Not applicable': -1, 'Not Available': 0, '=': 1, '&lt;': 2, 'ND': 3, 'DE': 4}</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/maris_legacy.py#L151" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sanitizedetectionlimitcb" class="level3">
<h3 class="anchored" data-anchor-id="sanitizedetectionlimitcb">SanitizeDetectionLimitCB</h3>
<blockquote class="blockquote">
<pre><code> SanitizeDetectionLimitCB (fn_lut=&lt;function &lt;lambda&gt;&gt;, dl_name='DL')</code></pre>
</blockquote>
<p><em>Assign Detection Limit name to its id based on MARIS nomenclature.</em></p>
<div id="c99e5640" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SanitizeDetectionLimitCB(Callback):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Assign Detection Limit name to its id based on MARIS nomenclature."</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 fn_lut<span class="op">=</span>dl_name_to_id,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                 dl_name<span class="op">=</span><span class="st">'DL'</span>):</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        fc.store_attr()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, tfm):</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        lut <span class="op">=</span> <span class="va">self</span>.fn_lut()</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> tfm.dfs.keys():</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>            tfm.dfs[k][<span class="va">self</span>.dl_name] <span class="op">=</span> tfm.dfs[k][<span class="va">self</span>.dl_name].replace(lut)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="e71200b5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB()</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>dfs_tfm <span class="op">=</span> tfm()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Keys:'</span>, dfs_tfm.keys())</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Columns:'</span>, dfs_tfm[<span class="st">'BIOTA'</span>].columns)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>dfs_tfm[<span class="st">"BIOTA"</span>][<span class="st">"DL"</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>dfs_tfm[<span class="st">"BIOTA"</span>]<span class="sc">.</span>head()<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys: dict_keys(['BIOTA', 'SEAWATER', 'SEDIMENT'])
Columns: Index(['SMP_ID', 'LAT', 'LON', 'TIME', 'SMP_DEPTH', 'STATION', 'UNC', 'UNIT',
       'DL', 'AREA', 'SPECIES', 'BIO_GROUP', 'BODY_PART', 'PREP_MET',
       'COUNT_MET', 'VALUE', 'NUCLIDE'],
      dtype='object')
[1 2]
        SMP_ID    LAT        LON                     TIME  SMP_DEPTH STATION  \
603199  638133  57.25  12.083333  1986-01-31 00:00:00.000        0.0  RINGHA   
603200  638133  57.25  12.083333  1986-01-31 00:00:00.000        0.0  RINGHA   
603201  638134  57.25  12.083333  1986-02-28 00:00:00.000        0.0  RINGHA   
603202  638134  57.25  12.083333  1986-02-28 00:00:00.000        0.0  RINGHA   
603203  638134  57.25  12.083333  1986-02-28 00:00:00.000        0.0  RINGHA   

         UNC  UNIT  DL  AREA  SPECIES  BIO_GROUP  BODY_PART  PREP_MET  \
603199  0.25     5   1  2374      129         14         19         7   
603200  0.45     5   1  2374      129         14         19         7   
603201  0.52     5   1  2374      129         14         19         7   
603202  0.49     5   1  2374      129         14         19         7   
603203  0.78     5   1  2374      129         14         19         7   

        COUNT_MET  VALUE  NUCLIDE  
603199         20    2.5       33  
603200         20    4.5        9  
603201         20    2.6       33  
603202         20    4.9        9  
603203         20    3.9       22  </code></pre>
</div>
</div>
</section>
<section id="parse-and-encode-time" class="level3">
<h3 class="anchored" data-anchor-id="parse-and-encode-time">Parse and encode time</h3>
<p>We remind that in <code>netCDF</code> format time need to be encoded as <code>integer</code> representing the number of seconds since a time of reference. In our case we chose <code>1970-01-01 00:00:00.0</code> as defined in <code>configs.ipynb</code>.</p>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/geotraces.py#L246" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="parsetimecb" class="level3">
<h3 class="anchored" data-anchor-id="parsetimecb">ParseTimeCB</h3>
<blockquote class="blockquote">
<pre><code> ParseTimeCB (time_name='TIME')</code></pre>
</blockquote>
<p><em>Parse time column from MARIS dump.</em></p>
<div id="434da9d4" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ParseTimeCB(Callback):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Parse time column from MARIS dump."</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                 time_name<span class="op">=</span><span class="st">'TIME'</span>):</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        fc.store_attr()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, tfm):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> tfm.dfs.keys():</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            tfm.dfs[k][<span class="va">self</span>.time_name] <span class="op">=</span> pd.to_datetime(tfm.dfs[k][<span class="va">self</span>.time_name], <span class="bu">format</span><span class="op">=</span><span class="st">'ISO8601'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="3ebcdf32" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB(),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    ParseTimeCB(),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    EncodeTimeCB()</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tfm()[<span class="st">'BIOTA'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SMP_ID        LAT        LON        TIME  SMP_DEPTH STATION      UNC  \
603199  638133  57.250000  12.083333   507513600        0.0  RINGHA  0.25000   
603200  638133  57.250000  12.083333   507513600        0.0  RINGHA  0.45000   
603201  638134  57.250000  12.083333   509932800        0.0  RINGHA  0.52000   
603202  638134  57.250000  12.083333   509932800        0.0  RINGHA  0.49000   
603203  638134  57.250000  12.083333   509932800        0.0  RINGHA  0.78000   
...        ...        ...        ...         ...        ...     ...      ...   
965909  639100  63.050000  21.616667   518572800        0.0   VAASA  0.01440   
965910  639100  63.050000  21.616667   518572800        0.0   VAASA      NaN   
965911  639137  63.066667  21.400000  1114732800        0.0   VAASA  1.46500   
965912  639137  63.066667  21.400000  1114732800        0.0   VAASA  0.00204   
965913  639137  63.066667  21.400000  1114732800        0.0   VAASA  5.00000   

        UNIT  DL  AREA  SPECIES  BIO_GROUP  BODY_PART  PREP_MET  COUNT_MET  \
603199     5   1  2374      129         14         19         7         20   
603200     5   1  2374      129         14         19         7         20   
603201     5   1  2374      129         14         19         7         20   
603202     5   1  2374      129         14         19         7         20   
603203     5   1  2374      129         14         19         7         20   
...      ...  ..   ...      ...        ...        ...       ...        ...   
965909     5   1  9999      269          4         52        12          9   
965910     5   1  9999      269          4         52        12          9   
965911     5   1  9999      269          4         52         0         20   
965912     5   1  9999      269          4         52         0          8   
965913     5   1  9999      269          4         52         0         20   

          VALUE  NUCLIDE  
603199    2.500       33  
603200    4.500        9  
603201    2.600       33  
603202    4.900        9  
603203    3.900       22  
...         ...      ...  
965909    0.072       12  
965910    0.015       11  
965911   29.300       33  
965912    0.017       12  
965913  113.000        4  

[14872 rows x 17 columns]</code></pre>
</div>
</div>
</section>
<section id="sanitize-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="sanitize-coordinates">Sanitize coordinates</h3>
<p>We ensure that coordinates are within the valid range.</p>
<div id="80141e2a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB(),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    ParseTimeCB(),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    EncodeTimeCB(),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    SanitizeLonLatCB()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>dfs_test <span class="op">=</span> tfm()</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>dfs_test[<span class="st">'BIOTA'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SMP_ID</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">STATION</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">SPECIES</th>
<th data-quarto-table-cell-role="th">BIO_GROUP</th>
<th data-quarto-table-cell-role="th">BODY_PART</th>
<th data-quarto-table-cell-role="th">PREP_MET</th>
<th data-quarto-table-cell-role="th">COUNT_MET</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">603199</th>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.25000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.500</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">603200</th>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.45000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.500</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">603201</th>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.52000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.600</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">603202</th>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.49000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.900</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">603203</th>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.78000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>3.900</td>
<td>22</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">965909</th>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.01440</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.072</td>
<td>12</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">965910</th>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>NaN</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.015</td>
<td>11</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">965911</th>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>1.46500</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>29.300</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">965912</th>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.00204</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>8</td>
<td>0.017</td>
<td>12</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">965913</th>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>5.00000</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>113.000</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>14872 rows × 17 columns</p>
</div>
</div>
</div>
</section>
<section id="set-unique-index" class="level3">
<h3 class="anchored" data-anchor-id="set-unique-index">Set unique index</h3>
<div id="b2114ddc" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB(),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    ParseTimeCB(),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    EncodeTimeCB(),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    SanitizeLonLatCB(),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    UniqueIndexCB()</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>dfs_test <span class="op">=</span> tfm()    </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>dfs_test[<span class="st">'BIOTA'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SMP_ID</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">STATION</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">SPECIES</th>
<th data-quarto-table-cell-role="th">BIO_GROUP</th>
<th data-quarto-table-cell-role="th">BODY_PART</th>
<th data-quarto-table-cell-role="th">PREP_MET</th>
<th data-quarto-table-cell-role="th">COUNT_MET</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.25000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.500</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.45000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.500</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.52000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.600</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>3</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.49000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.900</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>4</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.78000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>3.900</td>
<td>22</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14867</th>
<td>14867</td>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.01440</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.072</td>
<td>12</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14868</th>
<td>14868</td>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>NaN</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.015</td>
<td>11</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14869</th>
<td>14869</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>1.46500</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>29.300</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14870</th>
<td>14870</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.00204</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>8</td>
<td>0.017</td>
<td>12</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14871</th>
<td>14871</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>5.00000</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>113.000</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>14872 rows × 18 columns</p>
</div>
</div>
</div>
<div id="1ec780a3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB(),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    ParseTimeCB(),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    EncodeTimeCB(),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    SanitizeLonLatCB(),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    UniqueIndexCB()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>dfs_test <span class="op">=</span> tfm()    </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>dfs_test[<span class="st">'BIOTA'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SMP_ID</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">LON</th>
<th data-quarto-table-cell-role="th">TIME</th>
<th data-quarto-table-cell-role="th">SMP_DEPTH</th>
<th data-quarto-table-cell-role="th">STATION</th>
<th data-quarto-table-cell-role="th">UNC</th>
<th data-quarto-table-cell-role="th">UNIT</th>
<th data-quarto-table-cell-role="th">DL</th>
<th data-quarto-table-cell-role="th">AREA</th>
<th data-quarto-table-cell-role="th">SPECIES</th>
<th data-quarto-table-cell-role="th">BIO_GROUP</th>
<th data-quarto-table-cell-role="th">BODY_PART</th>
<th data-quarto-table-cell-role="th">PREP_MET</th>
<th data-quarto-table-cell-role="th">COUNT_MET</th>
<th data-quarto-table-cell-role="th">VALUE</th>
<th data-quarto-table-cell-role="th">NUCLIDE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.25000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.500</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>638133</td>
<td>57.250000</td>
<td>12.083333</td>
<td>507513600</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.45000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.500</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.52000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>2.600</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>3</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.49000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>4.900</td>
<td>9</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>4</td>
<td>638134</td>
<td>57.250000</td>
<td>12.083333</td>
<td>509932800</td>
<td>0.0</td>
<td>RINGHA</td>
<td>0.78000</td>
<td>5</td>
<td>1</td>
<td>2374</td>
<td>129</td>
<td>14</td>
<td>19</td>
<td>7</td>
<td>20</td>
<td>3.900</td>
<td>22</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14867</th>
<td>14867</td>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.01440</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.072</td>
<td>12</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14868</th>
<td>14868</td>
<td>639100</td>
<td>63.050000</td>
<td>21.616667</td>
<td>518572800</td>
<td>0.0</td>
<td>VAASA</td>
<td>NaN</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>12</td>
<td>9</td>
<td>0.015</td>
<td>11</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14869</th>
<td>14869</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>1.46500</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>29.300</td>
<td>33</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14870</th>
<td>14870</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>0.00204</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>8</td>
<td>0.017</td>
<td>12</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14871</th>
<td>14871</td>
<td>639137</td>
<td>63.066667</td>
<td>21.400000</td>
<td>1114732800</td>
<td>0.0</td>
<td>VAASA</td>
<td>5.00000</td>
<td>5</td>
<td>1</td>
<td>9999</td>
<td>269</td>
<td>4</td>
<td>52</td>
<td>0</td>
<td>20</td>
<td>113.000</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>14872 rows × 18 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="encode-to-netcdf" class="level2">
<h2 class="anchored" data-anchor-id="encode-to-netcdf">Encode to NetCDF</h2>
<div id="c55f5ef3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    CastStationToStringCB(),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    DropNAColumnsCB(),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    SanitizeDetectionLimitCB(),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    ParseTimeCB(),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    EncodeTimeCB(),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    SanitizeLonLatCB(),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    UniqueIndexCB()</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>dfs_tfm <span class="op">=</span> tfm()</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>tfm.logs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['Select columns of interest.',
 'Renaming variables to MARIS standard names.',
 'Convert STATION column to string type, filling any missing values with empty string',
 "Drop variable containing only NaN or 'Not available' (id=0 in MARIS lookup tables).",
 'Assign Detection Limit name to its id based on MARIS nomenclature.',
 'Parse time column from MARIS dump.',
 'Encode time as seconds since epoch.',
 'Drop rows with invalid longitude &amp; latitude values. Convert `,` separator to `.` separator.',
 'Set unique index for each group.']</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/geotraces.py#L269" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_attrs" class="level3">
<h3 class="anchored" data-anchor-id="get_attrs">get_attrs</h3>
<blockquote class="blockquote">
<pre><code> get_attrs (tfm, zotero_key, kw=['oceanography', 'Earth Science &gt; Oceans &gt;
            Ocean Chemistry&gt; Radionuclides', 'Earth Science &gt; Human
            Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation
            Exposure', 'Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean
            Tracers, Earth Science &gt; Oceans &gt; Marine Sediments', 'Earth
            Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt;
            Sea Ice &gt; Isotopes', 'Earth Science &gt; Oceans &gt; Water Quality &gt;
            Ocean Contaminants', 'Earth Science &gt; Biological
            Classification &gt; Animals/Vertebrates &gt; Fish', 'Earth Science &gt;
            Biosphere &gt; Ecosystems &gt; Marine Ecosystems', 'Earth Science &gt;
            Biological Classification &gt; Animals/Invertebrates &gt; Mollusks',
            'Earth Science &gt; Biological Classification &gt;
            Animals/Invertebrates &gt; Arthropods &gt; Crustaceans', 'Earth
            Science &gt; Biological Classification &gt; Plants &gt; Macroalgae
            (Seaweeds)'])</code></pre>
</blockquote>
<p><em>Retrieve global attributes from MARIS dump.</em></p>
<div id="f98fd736" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>kw <span class="op">=</span> [<span class="st">'oceanography'</span>, <span class="st">'Earth Science &gt; Oceans &gt; Ocean Chemistry&gt; Radionuclides'</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Human Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation Exposure'</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean Tracers, Earth Science &gt; Oceans &gt; Marine Sediments'</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt; Sea Ice &gt; Isotopes'</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Oceans &gt; Water Quality &gt; Ocean Contaminants'</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Biological Classification &gt; Animals/Vertebrates &gt; Fish'</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems'</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks'</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans'</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="ca5357b7" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_attrs(tfm, zotero_key, kw<span class="op">=</span>kw):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Retrieve global attributes from MARIS dump."</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> GlobAttrsFeeder(tfm.dfs, cbs<span class="op">=</span>[</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        BboxCB(),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        DepthRangeCB(),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        TimeRangeCB(),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        ZoteroCB(zotero_key, cfg<span class="op">=</span>cfg()),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        KeyValuePairCB(<span class="st">'keywords'</span>, <span class="st">', '</span>.join(kw)),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        KeyValuePairCB(<span class="st">'publisher_postprocess_logs'</span>, <span class="st">', '</span>.join(tfm.logs))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        ])()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="6385d9e3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>get_attrs(tfm, zotero_key<span class="op">=</span><span class="st">'3W354SQG'</span>, kw<span class="op">=</span>kw)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'geospatial_lat_min': '137.8475',
 'geospatial_lat_max': '31.2575',
 'geospatial_lon_min': '88.9988888888889',
 'geospatial_lon_max': '-42.3086111111111',
 'geospatial_bounds': 'POLYGON ((88.9988888888889 -42.3086111111111, 137.8475 -42.3086111111111, 137.8475 31.2575, 88.9988888888889 31.2575, 88.9988888888889 -42.3086111111111))',
 'time_coverage_start': '1996-12-20T00:00:00',
 'time_coverage_end': '1997-02-11T00:00:00',
 'id': '3W354SQG',
 'title': 'Radioactivity Monitoring of the Irish Marine Environment 1991 and 1992',
 'summary': '',
 'creator_name': '[{"creatorType": "author", "firstName": "A.", "lastName": "McGarry"}, {"creatorType": "author", "firstName": "S.", "lastName": "Lyons"}, {"creatorType": "author", "firstName": "C.", "lastName": "McEnri"}, {"creatorType": "author", "firstName": "T.", "lastName": "Ryan"}, {"creatorType": "author", "firstName": "M.", "lastName": "O\'Colmain"}, {"creatorType": "author", "firstName": "J.D.", "lastName": "Cunningham"}]',
 'keywords': 'oceanography, Earth Science &gt; Oceans &gt; Ocean Chemistry&gt; Radionuclides, Earth Science &gt; Human Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation Exposure, Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean Tracers, Earth Science &gt; Oceans &gt; Marine Sediments, Earth Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt; Sea Ice &gt; Isotopes, Earth Science &gt; Oceans &gt; Water Quality &gt; Ocean Contaminants, Earth Science &gt; Biological Classification &gt; Animals/Vertebrates &gt; Fish, Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans, Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)',
 'publisher_postprocess_logs': "Select columns of interest., Renaming variables to MARIS standard names., Convert STATION column to string type, filling any missing values with empty string, Drop variable containing only NaN or 'Not available' (id=0 in MARIS lookup tables)., Assign Detection Limit name to its id based on MARIS nomenclature., Parse time column from MARIS dump., Encode time as seconds since epoch., Drop rows with invalid longitude &amp; latitude values. Convert `,` separator to `.` separator., Set unique index for each group."}</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marisco/blob/main/marisco/handlers/geotraces.py#L281" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="encode" class="level3">
<h3 class="anchored" data-anchor-id="encode">encode</h3>
<blockquote class="blockquote">
<pre><code> encode (fname_in:str, dir_dest:str, **kwargs)</code></pre>
</blockquote>
<p><em>Encode MARIS dump to NetCDF.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fname_in</td>
<td>str</td>
<td>Path to the MARIS dump data in CSV format</td>
</tr>
<tr class="even">
<td>dir_dest</td>
<td>str</td>
<td>Path to the folder where the NetCDF output will be saved</td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
</tr>
</tbody>
</table>
<div id="63419143" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    fname_in: <span class="bu">str</span>, <span class="co"># Path to the MARIS dump data in CSV format</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    dir_dest: <span class="bu">str</span>, <span class="co"># Path to the folder where the NetCDF output will be saved</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>kwargs <span class="co"># Additional keyword arguments</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Encode MARIS dump to NetCDF."</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    dataloader <span class="op">=</span> DataLoader(fname_in)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    ref_ids <span class="op">=</span> kwargs.get(<span class="st">'ref_ids'</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ref_ids <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        ref_ids <span class="op">=</span> dataloader.df.ref_id.unique()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Encoding ...'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ref_id <span class="kw">in</span> tqdm(ref_ids, leave<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if ref_id == 736: continue</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        dfs <span class="op">=</span> dataloader(ref_id<span class="op">=</span>ref_id)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(get_fname(dfs))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        tfm <span class="op">=</span> Transformer(dfs, cbs<span class="op">=</span>[</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>            SelectColumnsCB(cois_renaming_rules),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>            RenameColumnsCB(cois_renaming_rules),</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>            CastStationToStringCB(),</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>            DropNAColumnsCB(),</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>            SanitizeDetectionLimitCB(),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>            ParseTimeCB(),</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>            EncodeTimeCB(),</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>            SanitizeLonLatCB(),</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>            UniqueIndexCB(),</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>        tfm()</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>        encoder <span class="op">=</span> NetCDFEncoder(tfm.dfs, </span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>                                dest_fname<span class="op">=</span>Path(dir_dest) <span class="op">/</span> get_fname(dfs), </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>                                global_attrs<span class="op">=</span>get_attrs(tfm, zotero_key<span class="op">=</span>get_zotero_key(dfs), kw<span class="op">=</span>kw),</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>                                verbose<span class="op">=</span>kwargs.get(<span class="st">'verbose'</span>, <span class="va">False</span>)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>        encoder.encode()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="single-dataset" class="level3">
<h3 class="anchored" data-anchor-id="single-dataset">Single dataset</h3>
<div id="26bd157d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ref_id <span class="op">=</span> <span class="dv">106</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>encode(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    fname_in,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    dir_dest,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    ref_ids<span class="op">=</span>[ref_id])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Encoding ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/1 [00:00&lt;?, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106.nc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                             </code></pre>
</div>
</div>
</section>
<section id="all-datasets" class="level3">
<h3 class="anchored" data-anchor-id="all-datasets">All datasets</h3>
<div id="c13a3f6f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>encode(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    fname_in, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    dir_dest, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    ref_ids<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/franckalbinet\.github\.io\/marisco");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/franckalbinet/marisco/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>